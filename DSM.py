# -*- coding: utf-8 -*-
# DSM.py — مرجع موسّع جدًا (تعليمي/إرشادي) لفئات DSM-5
# ⚠️ محتوى تثقيفي فقط—not medical advice ولا يغني عن التقييم الطبي المتخصص.

from typing import Dict, List, Any, Optional

class DSM:
    def __init__(self) -> None:
        # بنية البيانات:
        # "تصنيف" -> { "اضطراب" -> {
        #   "تعريف", "الأعراض", "المدة", "ملاحظات",
        #   "معايير مختصرة", "عوامل خطورة", "تشخيص تفريقي", "مقاييس شائعة"
        # }}
        self.data: Dict[str, Dict[str, Dict[str, Any]]] = {
            # =============== 1) نمائية عصبية ===============
            "الاضطرابات النمائية العصبية": {
                "اضطراب طيف التوحّد": {
                    "تعريف": "صعوبات تواصل اجتماعي وأنماط سلوك/اهتمامات مقيدة ومتكررة منذ الطفولة.",
                    "الأعراض": [
                        "تواصل لفظي/غير لفظي غير نموذجي",
                        "اهتمامات ضيقة/سلوكيات نمطية",
                        "استجابات حسّية غير معتادة"
                    ],
                    "المدة": "بداية مبكرة",
                    "ملاحظات": "تفاوت شديد بالقدرات؛ دعم أسري/تعليمي مهم.",
                    "معايير مختصرة": [
                        "عجز تواصل اجتماعي (تبادل/علاقات/تواصل غير لفظي)",
                        "سلوكيات/اهتمامات مقيدة",
                        "بداية مبكرة وتأثير وظيفي"
                    ],
                    "عوامل خطورة": ["عوامل وراثية", "عوامل قبل/أثناء الولادة"],
                    "تشخيص تفريقي": ["إعاقة ذهنية", "اضطراب لغة", "قلق اجتماعي"],
                    "مقاييس شائعة": ["ADOS (بحثي/سريري متخصص)", "AQ (غرض تثقيفي)"]
                },
                "ADHD (فرط حركة/تشتت)": {
                    "تعريف": "نقص انتباه و/أو فرط حركة-اندفاعية مؤثر وظيفيًا في بيئات متعددة.",
                    "الأعراض": ["تشتت", "نسيان", "اندفاع", "نشاط زائد"],
                    "المدة": "قبل 12 سنة، مستمر",
                    "ملاحظات": "جمع معلومات من مصادر متعددة (أسرة/مدرسة).",
                    "معايير مختصرة": [
                        "≥6 أعراض نقص انتباه و/أو فرط حركة لمدة ≥6 أشهر",
                        "ظهور مبكّر في سياقين أو أكثر",
                        "أثر وظيفي واضح"
                    ],
                    "عوامل خطورة": ["تاريخ عائلي", "عوامل محيطيّة مبكرة"],
                    "تشخيص تفريقي": ["قلق", "اكتئاب", "صعوبات تعلّم"],
                    "مقاييس شائعة": ["Vanderbilt", "Conners (للتعليم فقط)"]
                },
                "اضطرابات التعلّم المحدّدة": {
                    "تعريف": "صعوبات مستمرة في القراءة/الكتابة/الحساب تفوق المتوقع للعمر.",
                    "الأعراض": ["بطء القراءة", "أخطاء إملائية", "صعوبات حسابية"],
                    "المدة": "مزمن",
                    "ملاحظات": "يفيد الدعم التعليمي والتكييفات.",
                    "معايير مختصرة": ["صعوبات أكاديمية مستمرة", "بدء في الطفولة", "تأثير وظيفي"],
                    "عوامل خطورة": ["عائلي/تعليمي"],
                    "تشخيص تفريقي": ["ADHD", "عجز حسي (سمع/بصر)"],
                    "مقاييس شائعة": ["اختبارات تحصيل أكاديمي معيارية"]
                }
            },

            # =============== 2) القلق ===============
            "اضطرابات القلق": {
                "اضطراب القلق العام (GAD)": {
                    "تعريف": "قلق وتوجّس مفرط يصعب ضبطه تجاه مجالات متعددة.",
                    "الأعراض": ["توتر عضلي", "أرق", "صعوبة تركيز", "تعب", "تهيج"],
                    "المدة": "≥ 6 أشهر معظم الأيام",
                    "ملاحظات": "يسبّب ضيقًا أو تعطيلًا وظيفيًا.",
                    "معايير مختصرة": ["قلق مفرط", "صعوبة ضبط", "≥3 أعراض جسدية/معرفية"],
                    "عوامل خطورة": ["تعرّض لضغوط مزمنة", "سلوك قلق بالأسرة"],
                    "تشخيص تفريقي": ["قلق تكيفي", "قلق اجتماعي", "اكتئاب"],
                    "مقاييس شائعة": ["GAD-7 (تثقيفي)"]
                },
                "اضطراب الهلع": {
                    "تعريف": "نوبات هلع متكررة غير متوقعة مع قلق مترقب وتجنّب.",
                    "الأعراض": ["خفقان", "ضيق نفس", "دوار", "خوف من الموت/الجنون"],
                    "المدة": "شهر من قلق مترقّب/تجنّب",
                    "ملاحظات": "استبعاد أسباب طبية/منبّهات.",
                    "معايير مختصرة": ["نوبات متكررة", "قلق مترقب/تغيير سلوكي"],
                    "عوامل خطورة": ["حساسية للقلق", "كافيين/منبّهات"],
                    "تشخيص تفريقي": ["رهاب الساح", "فرط درق", "اضطراب قلبي"],
                    "مقاييس شائعة": ["PDSS (متخصص)", "Panic diary (ذاتي)"]
                },
                "الرهاب الاجتماعي": {
                    "تعريف": "خوف ملحوظ من مواقف التقييم الاجتماعي/خشية الإحراج.",
                    "الأعراض": ["تجنّب عروض ومحادثات", "احمرار/رجفة", "تعطّل الأداء"],
                    "المدة": "≥ 6 أشهر",
                    "ملاحظات": "ERP اجتماعي وإعادة تقييم معرفي مفيدان.",
                    "معايير مختصرة": ["خوف مستمر", "تجنّب", "أثر وظيفي"],
                    "عوامل خطورة": ["خجل الطفولة", "تجارب إذلال/تنمّر"],
                    "تشخيص تفريقي": ["شخصية تجنّبية", "توحد عالي الأداء"],
                    "مقاييس شائعة": ["LSAS (تثقيفي)"]
                },
                "الرهاب المحدد": {
                    "تعريف": "خوف شديد من موضوع/وضع محدد (طيران، حقن، حيوان...).",
                    "الأعراض": ["قلق فوري", "تجنّب صارم"],
                    "المدة": "≥ 6 أشهر",
                    "ملاحظات": "التعرّض المتدرّج فعّال جدًا.",
                    "معايير مختصرة": ["محفّز محدّد", "خوف غير متناسب", "تجنّب"],
                    "عوامل خطورة": ["تعلّم شرطي", "نموذجة أسرية"],
                    "تشخيص تفريقي": ["رهاب الساح", "وسواس قهري"],
                    "مقاييس شائعة": ["Fear Survey (ذاتي)"]
                },
                "رهاب الساح (Agoraphobia)": {
                    "تعريف": "خوف من مواقف يصعب فيها الهروب أو المساعدة.",
                    "الأعراض": ["تجنب مواصلات/أماكن مزدحمة", "رفيق أمان"],
                    "المدة": "≥ 6 أشهر",
                    "ملاحظات": "يترافق مع الهلع أحيانًا.",
                    "معايير مختصرة": ["≥2 سياقات خوف", "تجنب/قلق ملحوظ"],
                    "عوامل خطورة": ["نوبات هلع سابقة"],
                    "تشخيص تفريقي": ["رهاب اجتماعي", "هلع دون تجنّب ساح"],
                    "مقاييس شائعة": ["Mobility Inventory"]
                }
            },

            # =============== 3) المزاج ===============
            "اضطرابات المزاج": {
                "نوبة اكتئابية جسيمة": {
                    "تعريف": "مزاج مكتئب/فقد متعة معظم اليوم مع أعراض مصاحبة.",
                    "الأعراض": ["أرق/فرط نوم", "تغيّر شهية", "إرهاق", "ذنب/عدمية", "تشتت", "أفكار موت"],
                    "المدة": "≥ أسبوعين",
                    "ملاحظات": "تقييم السلامة أولوية إذا وُجدت أفكار انتحارية.",
                    "معايير مختصرة": ["≥5 أعراض بينها مزاج مكتئب أو فقد متعة", "أثر وظيفي"],
                    "عوامل خطورة": ["تاريخ عائلي", "ضغوط/فقد", "أمراض مزمنة"],
                    "تشخيص تفريقي": ["حزن طبيعي", "ثنائي القطب", "قصور الدرق"],
                    "مقاييس شائعة": ["PHQ-9 (تثقيفي)", "BDI (تعليمي)"]
                },
                "اكتئاب مستمر (عسر مزاج)": {
                    "تعريف": "مزاج مكتئب مزمن مع أعراض أخف من الجسيم.",
                    "الأعراض": ["طاقة منخفضة", "تدني تقدير الذات", "يأس"],
                    "المدة": "≥ سنتين (سنة للمراهقين)",
                    "ملاحظات": "قد يتخلّله نوبات جسيمة.",
                    "معايير مختصرة": ["مزاج منخفض مزمن", "≥2 أعراض داعمة"],
                    "عوامل خطورة": ["بدايات مبكرة", "تاريخ عائلي"],
                    "تشخيص تفريقي": ["MDD مستمر", "شخصية قسرية"],
                    "مقاييس شائعة": ["PHQ-9 بشكل دوري"]
                },
                "ثنائي القطب I": {
                    "تعريف": "نوبة هوس واحدة على الأقل ± اكتئاب.",
                    "الأعراض": ["مزاج مرتفع/متهيج", "قلة حاجة للنوم", "أفكار سباق", "اندفاعية"],
                    "المدة": "≥ أسبوع أو استشفاء",
                    "ملاحظات": "تقييم مخاطر وسلوكيات عالية مهم.",
                    "معايير مختصرة": ["هوس كامل", "أثر وظيفي/قانوني/اجتماعي"],
                    "عوامل خطورة": ["وراثة", "نوم متقطع", "منبّهات"],
                    "تشخيص تفريقي": ["ذهان فصامي عاطفي", "اضطرابات تعاطي"],
                    "مقاييس شائعة": ["YMRS (متخصص)"]
                },
                "ثنائي القطب II": {
                    "تعريف": "هوس خفيف + نوبات اكتئابية جسيمة.",
                    "الأعراض": ["طاقة مرتفعة خفيفة", "تغيّر نوم", "اندفاع محدود"],
                    "المدة": "هوس خفيف ≥ 4 أيام",
                    "ملاحظات": "يساء تشخيصه كاكتئاب فقط.",
                    "معايير مختصرة": ["تاريخ هوس خفيف + اكتئاب جسيم"],
                    "عوامل خطورة": ["عائلي", "سبق استجابة لمنظّم مزاج"],
                    "تشخيص تفريقي": ["شخصية حدية", "MDD"],
                    "مقاييس شائعة": ["HCL-32 (تثقيفي)"]
                }
            },

            # =============== 4) ذهانية ===============
            "الاضطرابات الذهانية": {
                "فصام": {
                    "تعريف": "أوهام/هلوسات/تفكك/سلوك غير منظّم/أعراض سلبية لمدة كافية.",
                    "الأعراض": ["أوهام", "هلوسات سمعية", "انسحاب/بلادة"],
                    "المدة": "≥ 6 أشهر (نشطة ≥ شهر)",
                    "ملاحظات": "رعاية طويلة المدى متعددة التخصصات.",
                    "معايير مختصرة": ["≥2 أعراض أساسية أحدها أوهام/هلوسات/تفكك"],
                    "عوامل خطورة": ["عائلي", "تعاطي محفّزات", "ضغوط مبكرة"],
                    "تشخيص تفريقي": ["اضطراب فصامي عاطفي", "ذهان دوائي"],
                    "مقاييس شائعة": ["PANSS (متخصص)"]
                },
                "ذهاني وجيز": {
                    "تعريف": "أعراض ذهانية أقل من شهر مع عودة للخط الأساس.",
                    "الأعراض": ["أوهام/هلوسات/تفكك"],
                    "المدة": "< شهر",
                    "ملاحظات": "قد يرتبط بضغط شديد.",
                    "معايير مختصرة": ["بداية حادة", "مدة قصيرة", "عودة كاملة"],
                    "عوامل خطورة": ["ضغط نفسي", "عوامل شخصية"],
                    "تشخيص تفريقي": ["ذهان عضوي", "استخدام مواد"],
                    "مقاييس شائعة": ["BPRS"]
                }
            },

            # =============== 5) وسواس وما يرتبط به ===============
            "الوسواس القهري وما يرتبط به": {
                "OCD": {
                    "تعريف": "وساوس/قهور تستغرق وقتًا وتسبب ضيقًا/تعطيلًا.",
                    "الأعراض": ["غسل", "فحص", "عدّ/ترتيب", "أفكار اقتحامية"],
                    "المدة": "يومي/ملحوظ",
                    "ملاحظات": "ERP فعّال جدًا مع دعم معرفي.",
                    "معايير مختصرة": ["وساوس أو قهور أو كليهما", "ضيق/أثر وظيفي"],
                    "عوامل خطورة": ["كمالية", "تجنّب"],
                    "تشخيص تفريقي": ["OCPD", "اضطرابات قلق"],
                    "مقاييس شائعة": ["Y-BOCS (تثقيفي/متخصص)"]
                },
                "BDD (تشوّه صورة الجسد)": {
                    "تعريف": "انشغال بعيب متخيّل/مبالغ فيه في المظهر.",
                    "الأعراض": ["تفحّص مرآة", "إخفاء", "تجنّب/انشغال"],
                    "المدة": "مزمن",
                    "ملاحظات": "CBT مركّز مفيد.",
                    "معايير مختصرة": ["انشغال مظهر", "سلوكيات متكررة", "ضيق/تعطيل"],
                    "عوامل خطورة": ["تنمّر", "مثالية مظهر"],
                    "تشخيص تفريقي": ["OCD", "اضطرابات أكل"],
                    "مقاييس شائعة": ["BDD-YBOCS (متخصص)"]
                },
                "اكتناز": {
                    "تعريف": "صعوبة التخلص من الممتلكات مع تراكم معيق.",
                    "الأعراض": ["فوضى بالمنزل", "ضيق عند التخلص"],
                    "المدة": "مزمن",
                    "ملاحظات": "خطة تدريجية طويلة المدى.",
                    "معايير مختصرة": ["صعوبة تخلّص", "تراكم", "أثر وظيفي/أمان"],
                    "عوامل خطورة": ["فقد/صدمة", "قرارات صعبة"],
                    "تشخيص تفريقي": ["OCD", "ذهان"],
                    "مقاييس شائعة": ["HRS-I"]
                }
            },

            # =============== 6) صدمة/ضغوط ===============
            "اضطرابات الصدمة والضغوط": {
                "PTSD": {
                    "تعريف": "أعراض لاحقة لحدث صادم: اقتحامية/تجنّب/تغير مزاج/فرط يقظة.",
                    "الأعراض": ["استرجاعات", "كوابيس", "تجنّب", "يقظة مفرطة"],
                    "المدة": "> شهر",
                    "ملاحظات": "علاج تعرّض/معالجة معرفية فعال.",
                    "معايير مختصرة": ["تعرض مباشر/غير مباشر", "عناقيد أعراض 4", "أثر وظيفي"],
                    "عوامل خطورة": ["صدمة شديدة/متكررة", "دعم اجتماعي ضعيف"],
                    "تشخيص تفريقي": ["ASD", "اكتئاب", "قلق عام"],
                    "مقاييس شائعة": ["PCL-5 (تثقيفي)"]
                },
                "ASD": {
                    "تعريف": "أعراض شبيهة بـPTSD خلال أول 3-30 يومًا بعد الحدث.",
                    "الأعراض": ["اقتحامية", "تجنّب", "تبدد", "استثارة"],
                    "المدة": "3–30 يومًا",
                    "ملاحظات": "قد يتطور إلى PTSD.",
                    "معايير مختصرة": ["بدء حاد بعد الحدث", "مدة محدودة"],
                    "عوامل خطورة": ["شدة الحدث", "عوامل سابقة"],
                    "تشخيص تفريقي": ["PTSD", "قلق/اكتئاب"],
                    "مقاييس شائعة": ["ASDS"]
                }
            },

            # =============== 7) تفارقية ===============
            "الاضطرابات التفارقية": {
                "تفارُق الهوية": {
                    "تعريف": "اضطراب هوية مع فجوات ذاكرة متكررة.",
                    "الأعراض": ["تبدّل إحساس بالذات", "فجوات تذكّر"],
                    "المدة": "مزمن",
                    "ملاحظات": "علاج تخصصي طويل.",
                    "معايير مختصرة": ["تبدّل هوية", "فقد ذاكرة"],
                    "عوامل خطورة": ["صدمات مبكرة"],
                    "تشخيص تفريقي": ["ذهان", "اختلال الآنية"],
                    "مقاييس شائعة": ["DES (تثقيفي)"]
                },
                "اختلال الآنية/الواقع": {
                    "تعريف": "شعور بعدم واقعية الذات/المحيط.",
                    "الأعراض": ["خَدَر عاطفي", "انفصال"],
                    "المدة": "متذبذب",
                    "ملاحظات": "تمارين تأريض مفيدة.",
                    "معايير مختصرة": ["خبرة ثابتة/متذبذبة", "بصيرة غالبًا موجودة"],
                    "عوامل خطورة": ["قلق/صدمة"],
                    "تشخيص تفريقي": ["ذهان", "صرع فصّ صدغي"],
                    "مقاييس شائعة": ["CDS"]
                }
            },

            # =============== 8) جسدية الشكل ===============
            "الاضطرابات الجسدية الشكل": {
                "اضطراب الأعراض الجسدية": {
                    "تعريف": "أعراض جسدية مع انشغال/قلق/سلوكيات صحية مفرطة.",
                    "الأعراض": ["ألم/تعب", "زيارات طبية متكررة"],
                    "المدة": "مزمن",
                    "ملاحظات": "نهج تكاملي (طبي/نفسي).",
                    "معايير مختصرة": ["أعراض + أفكار/سلوكيات مرتبطة"],
                    "عوامل خطورة": ["قلق/اكتئاب مرافق", "ضغط مزمن"],
                    "تشخيص تفريقي": ["حالات طبية فعلية", "قلق مرض"],
                    "مقاييس شائعة": ["PHQ-15"]
                },
                "قلق المرض": {
                    "تعريف": "خوف من مرض خطير رغم طمأنة الفحوص.",
                    "الأعراض": ["تفقد/بحث طبي", "قلق صحي"],
                    "المدة": "≥ 6 أشهر",
                    "ملاحظات": "CBT مركّز.",
                    "معايير مختصرة": ["انشغال صحي", "فحوص طبيعية غالبًا"],
                    "عوامل خطورة": ["تاريخ عائلي/تجربة مرض"],
                    "تشخيص تفريقي": ["Somatic Symptom", "OCD"],
                    "مقاييس شائعة": ["HAI"]
                }
            },

            # =============== 9) الأكل/التغذية ===============
            "اضطرابات التغذية والأكل": {
                "فقدان الشهية العصبي": {
                    "تعريف": "تقييد شديد للطعام وخوف من زيادة الوزن وتشوه صورة الجسد.",
                    "الأعراض": ["وزن منخفض", "طقوس أكل", "انقطاع طمث محتمل"],
                    "المدة": "متغير",
                    "ملاحظات": "أولوية للاستقرار الطبي إذا لزم.",
                    "معايير مختصرة": ["تقييد", "خوف وزن", "تشوّه صورة"],
                    "عوامل خطورة": ["مثالية", "تعليقات جسد", "رياضات وزن"],
                    "تشخيص تفريقي": ["نهَم/شره", "BED"],
                    "مقاييس شائعة": ["EDE-Q (تثقيفي)"]
                },
                "الشره المرضي": {
                    "تعريف": "نوبات أكل مفرط مع سلوك تعويضي متكرر.",
                    "الأعراض": ["تقيؤ/مسهل", "انشغال بالوزن/الشكل"],
                    "المدة": "≥ مرة/أسبوع لمدة 3 أشهر",
                    "ملاحظات": "CBT-ED فعّال.",
                    "معايير مختصرة": ["نهم + تعويض", "تقدير ذاتي متأثر بالشكل"],
                    "عوامل خطورة": ["حمية قاسية", "نقد مظهري"],
                    "تشخيص تفريقي": ["BED", "AN نوع نهَم"],
                    "مقاييس شائعة": ["BITE"]
                },
                "نهَم الطعام (BED)": {
                    "تعريف": "نوبات أكل مفرط دون تعويض منتظم.",
                    "الأعراض": ["أكل حتى الامتلاء المؤلم", "تأنيب"],
                    "المدة": "≥ مرة/أسبوع لمدة 3 أشهر",
                    "ملاحظات": "تنظيم وجبات/تنشيط.",
                    "معايير مختصرة": ["نهم متكرر", "ضيق", "لا تعويض"],
                    "عوامل خطورة": ["ضغط/مزاج", "حمية متكررة"],
                    "تشخيص تفريقي": ["بوليميا", "أكل عاطفي غير مرضي"],
                    "مقاييس شائعة": ["BES"]
                }
            },

            # =============== 10) نوم/يقظة ===============
            "اضطرابات النوم واليقظة": {
                "أرق مزمن": {
                    "تعريف": "صعوبة بدء/استمرار النوم مع أثر نهاري.",
                    "الأعراض": ["استيقاظ متكرر", "تعب/تشتت"],
                    "المدة": "≥ 3 شهور (≥ 3 ليال/أسبوع)",
                    "ملاحظات": "CBT-I خط أول.",
                    "معايير مختصرة": ["أعراض ليلية + أثر نهاري", "مدة ومعيار التكرار"],
                    "عوامل خطورة": ["قلق", "عادات نوم سيئة"],
                    "تشخيص تفريقي": ["انقطاع نفس أثناء النوم", "اكتئاب"],
                    "مقاييس شائعة": ["ISI"]
                },
                "نوم قهري": {
                    "تعريف": "نعاس نهاري شديد مع هجمات نوم وقد يصاحبه جاثوم/هلوسات.",
                    "الأعراض": ["شلل نوم", "هلوسات انتقالية"],
                    "المدة": "مزمن",
                    "ملاحظات": "يتطلب تقييم مختص نوم.",
                    "معايير مختصرة": ["نعاس ≥3 أشهر", "دلائل في اختبارات النوم"],
                    "عوامل خطورة": ["عائلي"],
                    "تشخيص تفريقي": ["فرط نعاس", "اكتئاب"],
                    "مقاييس شائعة": ["Epworth"]
                }
            },

            # =============== 11) جنسية/هوية جندرية (مقتضب تعليمي) ===============
            "خلل/اضطرابات جنسية (مقتضب)": {
                "اختلالات الرغبة/الإثارة/الانتصاب/القذف/الألم": {
                    "تعريف": "صعوبات مستمرة تسبب ضيقًا.",
                    "الأعراض": ["انخفاض رغبة/إثارة", "صعوبات أداء"],
                    "المدة": "≥ 6 أشهر غالبًا",
                    "ملاحظات": "عوامل نفسية/جسدية؛ تقييم مختص عند اللزوم.",
                    "معايير مختصرة": ["استمرارية", "ضيق شخصي"],
                    "عوامل خطورة": ["أمراض مزمنة", "أدوية", "توتر"],
                    "تشخيص تفريقي": ["أسباب طبية", "قلق أداء"],
                    "مقاييس شائعة": ["IIEF/FSFI (متخصص)"]
                }
            },
            "اضطراب الهوية الجندرية": {
                "ضيق الهوية الجندرية": {
                    "تعريف": "ضيق مرتبط بتباين الهوية الجندرية مقابل الجنس المسجل.",
                    "الأعراض": ["ضيق نفسي", "تحديات اجتماعية"],
                    "المدة": "متغيرة",
                    "ملاحظات": "رعاية حسّاسة متعددة التخصصات.",
                    "معايير مختصرة": ["ضيق ملموس", "استمرار"],
                    "عوامل خطورة": ["ضغط اجتماعي"],
                    "تشخيص تفريقي": ["اكتئاب/قلق مرافق"],
                    "مقاييس شائعة": ["GIDYQ (تعليمي)"]
                }
            },

            # =============== 12) تخريبية/اندفاعية/سلوكية ===============
            "الاضطرابات التخريبية/الاندفاعية/السلوكية": {
                "ODD (معارضة/عصيان)": {
                    "تعريف": "نمط جدلي/عدائي تجاه السلطة يتجاوز المتوقع عمريًا.",
                    "الأعراض": ["مشاحنات", "تحدٍّ للقواعد", "استفزاز"],
                    "المدة": "≥ 6 أشهر",
                    "ملاحظات": "تدريب والدية/خطة مدرسية.",
                    "معايير مختصرة": ["≥4 أعراض", "أثر وظيفي"],
                    "عوامل خطورة": ["توتر أسري", "نمط تواصل"],
                    "تشخيص تفريقي": ["ADHD", "اضطراب سلوك"],
                    "مقاييس شائعة": ["SNAP-IV"]
                },
                "اضطراب السلوك": {
                    "تعريف": "انتهاك حقوق الآخرين/القواعد الاجتماعية بشكل مستمر.",
                    "الأعراض": ["عدوان", "تخريب", "خداع/سرقة"],
                    "المدة": "مستمر منذ الطفولة/المراهقة",
                    "ملاحظات": "خطة متعددة الأنظمة.",
                    "معايير مختصرة": ["نمط مستمر", "ضرر/مخاطر"],
                    "عوامل خطورة": ["بيئة عالية المخاطر", "تاريخ ODD"],
                    "تشخيص تفريقي": ["شخصية معادية للمجتمع (بالغين)"],
                    "مقاييس شائعة": ["CBCL (تعليمي)"]
                }
            },

            # =============== 13) معرفية عصبية ===============
            "الاضطرابات المعرفية العصبية": {
                "اضطراب معرفي عصبي كبير (ألزهايمر/أجسام ليوي/وعائي)": {
                    "تعريف": "تدهور ملحوظ بمجالات معرفية يؤثر بالاستقلال.",
                    "الأعراض": ["ذاكرة/تنفيذ/لغة/انتباه"],
                    "المدة": "تقدّمي غالبًا",
                    "ملاحظات": "تشخيص تفريقي بحسب المسبّب.",
                    "معايير مختصرة": ["انخفاض موثق", "تأثير وظيفي واضح"],
                    "عوامل خطورة": ["عمر", "عوامل وعائية"],
                    "تشخيص تفريقي": ["اكتئاب كاذب", "MCI"],
                    "مقاييس شائعة": ["MMSE", "MoCA (تثقيفي)"]
                },
                "اضطراب معرفي عصبي خفيف": {
                    "تعريف": "تدهور خفيف لا يعطل الاستقلال",
                    "الأعراض": ["ذاكرة/انتباه/تنفيذ"],
                    "المدة": "متغير",
                    "ملاحظات": "متابعة دورية.",
                    "معايير مختصرة": ["انخفاض خفيف", "استقلالية محفوظة"],
                    "عوامل خطورة": ["عمر/عوامل وعائية"],
                    "تشخيص تفريقي": ["طبيعي حسب العمر"],
                    "مقاييس شائعة": ["MoCA"]
                }
            },

            # =============== 14) مواد/إدمان ===============
            "الاضطرابات المرتبطة بالمواد": {
                "اضطراب تعاطي المواد (عام)": {
                    "تعريف": "نمط مشكل لاستخدام مادة مع معايير اعتماد/ضرر.",
                    "الأعراض": ["تحمّل", "انسحاب", "تقليص فاشل", "وقت طويل للحصول/الاستخدام", "استمرار رغم الضرر"],
                    "المدة": "≥ 12 شهر",
                    "ملاحظات": "تمييز حسب الفئة (أفيونات/كحول/منبّهات…).",
                    "معايير مختصرة": ["≥2 من 11 معيارًا خلال سنة"],
                    "عوامل خطورة": ["عوامل وراثية/بيئية", "صدمات"],
                    "تشخيص تفريقي": ["استخدام غير إشكالي", "أسباب طبية/نفسية مرافقة"],
                    "مقاييس شائعة": ["ASSIST", "AUDIT (كحول)"]
                }
            },

            # =============== 15) اضطرابات الشخصية (A/B/C) ===============
            "اضطرابات الشخصية — المجموعة A": {
                "بارانويد": {
                    "تعريف": "شك وعدم ثقة مزمن بنوايا الآخرين.",
                    "الأعراض": ["تفسير عدائي", "حساسية للنقد", "يقظة مفرطة"],
                    "المدة": "مستمر منذ البلوغ",
                    "ملاحظات": "نادراً ما يطلب علاج.",
                    "معايير مختصرة": ["نمط شك عام", "تأثير على العلاقات"],
                    "عوامل خطورة": ["بيئات عدائية", "تجارب خيانة"],
                    "تشخيص تفريقي": ["ذهان", "قلق اجتماعي"],
                    "مقاييس شائعة": ["SCID-5-PD (متخصص)"]
                },
                "فصامية": {
                    "تعريف": "انفصال اجتماعي وعاطفة محدودة.",
                    "الأعراض": ["قلة رغبة بالعلاقات", "برود عاطفي"],
                    "المدة": "مستمر",
                    "ملاحظات": "يختلف عن الفصام.",
                    "معايير مختصرة": ["انعزال", "نطاق عاطفي محدود"],
                    "عوامل خطورة": ["تاريخ عائلي"],
                    "تشخيص تفريقي": ["اكتئاب", "توحد عالي الأداء"],
                    "مقاييس شائعة": ["SCID-5-PD"]
                },
                "شبه فصامية": {
                    "تعريف": "معتقدات/تجارب غريبة + قلق اجتماعي.",
                    "الأعراض": ["تفكير سحري", "إدراكات غير عادية"],
                    "المدة": "مستمر",
                    "ملاحظات": "خطر ذهان لاحقًا.",
                    "معايير مختصرة": ["تفكير غريب", "قلق اجتماعي"],
                    "عوامل خطورة": ["عائلي/وراثي"],
                    "تشخيص تفريقي": ["فصام مبكّر"],
                    "مقاييس شائعة": ["SPQ (تعليمي)"]
                }
            },
            "اضطرابات الشخصية — المجموعة B": {
                "حدّية": {
                    "تعريف": "عدم استقرار علاقات/هوية/عاطفة مع اندفاعية.",
                    "الأعراض": ["خوف هجر", "تقلبات حادة", "إيذاء ذاتي"],
                    "المدة": "مستمر",
                    "ملاحظات": "استجابات جيدة لـDBT.",
                    "معايير مختصرة": ["≥5 معايير DSM-5"],
                    "عوامل خطورة": ["صدمات مبكرة", "عدم استقرار أسري"],
                    "تشخيص تفريقي": ["ثنائي القطب", "PTSD مركّز"],
                    "مقاييس شائعة": ["MSI-BPD (تعليمي)"]
                },
                "نرجسية": {
                    "تعريف": "عظمة وحاجة للإعجاب ونقص تعاطف.",
                    "الأعراض": ["استغلال", "حساسية للنقد"],
                    "المدة": "مستمر",
                    "ملاحظات": "علاجيًا: تحالف علاجي صعب.",
                    "معايير مختصرة": ["عظمة", "حاجة للإعجاب", "نقص تعاطف"],
                    "عوامل خطورة": ["أنماط تربية/بيئة"],
                    "تشخيص تفريقي": ["هوس", "سمات شخصية عالية تقدير"],
                    "مقاييس شائعة": ["NPI (تعليمي)"]
                },
                "معادية للمجتمع": {
                    "تعريف": "تجاهل حقوق الآخرين وانتهاك القواعد.",
                    "الأعراض": ["خداع", "عدوانية", "اندفاع"],
                    "المدة": "منذ 15 سنة + تاريخ اضطراب سلوك",
                    "ملاحظات": "اعتبارات قانونية.",
                    "معايير مختصرة": ["نمط مستمر", "دلائل قبل 15 سنة"],
                    "عوامل خطورة": ["بيئات عالية المخاطر", "ODD مبكر"],
                    "تشخيص تفريقي": ["إدمان", "ثنائي القطب"],
                    "مقاييس شائعة": ["PCL:SV (متخصص)"]
                },
                "هستيرية": {
                    "تعريف": "بحث عن الانتباه وانفعالية.",
                    "الأعراض": ["درامية", "سطحية عاطفية", "إغواء غير مناسب"],
                    "المدة": "مستمر",
                    "ملاحظات": "تركيز على مهارات العلاقات.",
                    "معايير مختصرة": ["سعي للانتباه", "تكلف عاطفي"],
                    "عوامل خطورة": ["ديناميات أسرية"],
                    "تشخيص تفريقي": ["حدية", "نرجسية"],
                    "مقاييس شائعة": ["SCID-5-PD"]
                }
            },
            "اضطرابات الشخصية — المجموعة C": {
                "تجنّبية": {
                    "تعريف": "خجل شديد وتجنّب نقد بالرغم من الرغبة بالعلاقات.",
                    "الأعراض": ["تجنّب اجتماعي", "انخفاض تقدير الذات"],
                    "المدة": "مستمر",
                    "ملاحظات": "يتقاطع مع القلق الاجتماعي.",
                    "معايير مختصرة": ["حساسية للنقد", "تجنّب"],
                    "عوامل خطورة": ["خجل الطفولة"],
                    "تشخيص تفريقي": ["قلق اجتماعي"],
                    "مقاييس شائعة": ["SCID-5-PD"]
                },
                "اعتمادية": {
                    "تعريف": "حاجة مفرطة للرعاية تؤدي للخضوع وصعوبة اتخاذ القرار.",
                    "الأعراض": ["خوف الانفصال", "طلب نصح مستمر"],
                    "المدة": "مستمر",
                    "ملاحظات": "بناء الاستقلال هدف.",
                    "معايير مختصرة": ["صعوبة قرارات", "خوف الفراق"],
                    "عوامل خطورة": ["بيئات حامية مفرطة"],
                    "تشخيص تفريقي": ["اكتئاب", "قلق"],
                    "مقاييس شائعة": ["SCID-5-PD"]
                },
                "قسرية-وسواسية (OCPD)": {
                    "تعريف": "انشغال بالكمال والنظام على حساب المرونة.",
                    "الأعراض": ["تفاصيل/قوائم", "عناد", "بخل/تحفّظ"],
                    "المدة": "مستمر",
                    "ملاحظات": "تختلف عن OCD (لا وساوس/قهور مفروضة).",
                    "معايير مختصرة": ["كمالية", "انشغال بالتنظيم"],
                    "عوامل خطورة": ["سمات شخصية"],
                    "تشخيص تفريقي": ["OCD"],
                    "مقاييس شائعة": ["CPAS (تعليمي)"]
                }
            }
        }

    # ======= واجهات استخدام/بحث متقدمة =======
    def التصنيفات(self) -> List[str]:
        return list(self.data.keys())

    def قائمة_الاضطرابات(self, تصنيف: str) -> List[str]:
        return list(self.data.get(تصنيف, {}).keys())

    def معلومات_اضطراب(self, اسم: str) -> Optional[Dict[str, Any]]:
        for cat in self.data.values():
            if اسم in cat:
                return cat[اسم]
        return None

    def بحث_نصي(self, كلمة: str) -> List[str]:
        """بحث بسيط عبر الحقول النصية يُرجع أسماء الاضطرابات المطابقة."""
        كلمة = (كلمة or "").strip()
        if not كلمة:
            return []
        نتائج = []
        for تصنيف, اضطرابات in self.data.items():
            for اسم, info in اضطرابات.items():
                النص = " ".join([
                    اسم, تصنيف,
                    info.get("تعريف",""),
                    " ".join(info.get("الأعراض",[])),
                    " ".join(info.get("معايير مختصرة",[])),
                    " ".join(info.get("تشخيص تفريقي",[])),
                    " ".join(info.get("عوامل خطورة",[])),
                    " ".join(info.get("مقاييس شائعة",[])),
                    info.get("ملاحظات",""),
                    info.get("المدة","")
                ])
                if كلمة in النص:
                    نتائج.append(اسم)
        return sorted(set(نتائج))

    def اضطرابات_حسب_عامل(self, العامل: str) -> List[str]:
        """يعيد الاضطرابات التي تتضمن العامل ضمن 'عوامل خطورة'."""
        نتائج = []
        for اضطرابات in self.data.values():
            for اسم, info in اضطرابات.items():
                if any(العامل in s for s in info.get("عوامل خطورة", [])):
                    نتائج.append(اسم)
        return sorted(set(نتائج))

    def اضطرابات_تشخيص_تفريقي_يحتوي(self, كلمة: str) -> List[str]:
        """يرجع الاضطرابات التي تذكر كلمة معيّنة في التشخيص التفريقي."""
        نتائج = []
        for اضطرابات in self.data.values():
            for اسم, info in اضطرابات.items():
                if any(k for k in info.get("تشخيص تفريقي", []) if كلمة in k):
                    نتائج.append(اسم)
        return sorted(set(نتائج))

    # ======= HTML موسّع لواجهة الويب =======
    def html_تصنيف(self, تصنيف: str) -> str:
        cat = self.data.get(تصنيف, {})
        if not cat:
            return "<p>التصنيف غير موجود.</p>"
        parts = [f"<h2>{تصنيف}</h2>"]
        # روابط سريعة داخلية
        روابط = [f"<a class='btn' href='#d_{i}'>{name}</a>" for i, name in enumerate(cat.keys(), 1)]
        parts.append("<div class='btns'>" + " ".join(روابط) + "</div>")

        for i, (dname, info) in enumerate(cat.items(), 1):
            parts.append(f"<div class='card' id='d_{i}'>")
            parts.append(f"<h3>{dname}</h3>")
            parts.append(f"<p><b>تعريف:</b> {info.get('تعريف','')}</p>")

            if info.get("الأعراض"):
                parts.append("<h4>الأعراض الأساسية</h4><ul>" + "".join([f"<li>{s}</li>" for s in info["الأعراض"]]) + "</ul>")

            # معايير مختصرة
            if info.get("معايير مختصرة"):
                parts.append("<h4>معايير مختصرة (فهم سريع)</h4><ul>" + "".join([f"<li>{s}</li>" for s in info["معايير مختصرة"]]) + "</ul>")

            # عوامل خطورة
            if info.get("عوامل خطورة"):
                parts.append("<h4>عوامل خطورة</h4><ul>" + "".join([f"<li>{s}</li>" for s in info["عوامل خطورة"]]) + "</ul>")

            # تشخيص تفريقي
            if info.get("تشخيص تفريقي"):
                parts.append("<h4>تشخيص تفريقي</h4><ul>" + "".join([f"<li>{s}</li>" for s in info["تشخيص تفريقي"]]) + "</ul>")

            # مقاييس شائعة
            if info.get("مقاييس شائعة"):
                parts.append("<h4>مقاييس/استبيانات شائعة (للتثقيف)</h4><ul>" + "".join([f"<li>{s}</li>" for s in info["مقاييس شائعة"]]) + "</ul>")

            parts.append(f"<p><b>المدة:</b> {info.get('المدة','-')} — <b>ملاحظات:</b> {info.get('ملاحظات','-')}</p>")
            parts.append("</div>")
        return "\n".join(parts)

    def html_اضطراب(self, اسم: str) -> str:
        info = self.معلومات_اضطراب(اسم)
        if not info:
            return "<p>الاضطراب غير موجود.</p>"
        parts = [f"<h2>{اسم}</h2>"]
        parts.append(f"<p><b>تعريف:</b> {info.get('تعريف','')}</p>")

        if info.get("الأعراض"):
            parts.append("<h4>الأعراض الأساسية</h4><ul>" + "".join([f"<li>{s}</li>" for s in info["الأعراض"]]) + "</ul>")
        if info.get("معايير مختصرة"):
            parts.append("<h4>معايير مختصرة</h4><ul>" + "".join([f"<li>{s}</li>" for s in info["معايير مختصرة"]]) + "</ul>")
        if info.get("عوامل خطورة"):
            parts.append("<h4>عوامل خطورة</h4><ul>" + "".join([f"<li>{s}</li>" for s in info["عوامل خطورة"]]) + "</ul>")
        if info.get("تشخيص تفريقي"):
            parts.append("<h4>تشخيص تفريقي</h4><ul>" + "".join([f"<li>{s}</li>" for s in info["تشخيص تفريقي"]]) + "</ul>")
        if info.get("مقاييس شائعة"):
            parts.append("<h4>مقاييس/استبيانات شائعة (للتثقيف)</h4><ul>" + "".join([f"<li>{s}</li>" for s in info["مقاييس شائعة"]]) + "</ul>")

        parts.append(f"<p><b>المدة:</b> {info.get('المدة','-')} — <b>ملاحظات:</b> {info.get('ملاحظات','-')}</p>")
        return "\n".join(parts)

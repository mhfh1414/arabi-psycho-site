# -*- coding: utf-8 -*-
# dsm_suite_enhanced.py - نظام تشخيص نفسي موسع ومتقدم

import re
import json
from collections import defaultdict
from datetime import datetime
import math

# ============================= أدوات لغوية متقدمة =============================
_AR_DIAC = r"[ًٌٍَُِّْـ]"
_AR_PUNCT = r"[.,،;؛!?؟()\[\]{}\"\'<>]"

def normalize(s: str) -> str:
    if not s: return ""
    s = s.strip()
    s = re.sub(_AR_DIAC, "", s)
    s = re.sub(_AR_PUNCT, " ", s)
    s = (s.replace("أ","ا").replace("إ","ا").replace("آ","ا")
           .replace("ة","ه").replace("ى","ي").replace("ؤ","و").replace("ئ","ي")
           .replace("ـ", "").replace("ﻻ", "لا").replace("ﻷ", "لا"))
    s = re.sub(r"\s+", " ", s)
    return s.lower()

def tokenize(s: str):
    s = normalize(s)
    return s.split()

def contains_phrase(text_norm: str, phrase: str) -> bool:
    return normalize(phrase) in text_norm

def calculate_similarity(text: str, phrase: str) -> float:
    """احسب درجة التشابه بين النص والعبارة باستخدام خوارزمية مبسطة"""
    text_tokens = set(tokenize(text))
    phrase_tokens = set(tokenize(phrase))
    
    if not phrase_tokens:
        return 0.0
        
    intersection = text_tokens.intersection(phrase_tokens)
    return len(intersection) / len(phrase_tokens)

# ============================= مرادفات موسعة لتعزيز المطابقة =============================
SYNONYMS = {
    # مزاج/اكتئاب
    "حزن": ["زعل", "كدر", "طفش", "غم", "ضيقه", "هم", "اكتئاب", "تعاسة", "بؤس", "كآبة"],
    "انعدام المتعة": ["فقدان المتعه", "مافي متعه", "عدم استمتاع", "لا استمتع", "انعدام اللذة", "فقدان الاهتمام"],
    "طاقة منخفضة": ["خمول", "كسل", "ارهاق", "تعب", "مافي طاقه", "إعياء", "نعاس", "وهن"],
    "اضطراب نوم": ["قلة نوم", "كثرة نوم", "ارق", "نوم متقطع", "استيقاظ مبكر", "أرق", "نوم غير مريح", "صعوبة النوم"],
    "شهية منخفضة": ["قلة اكل", "ما اقدر اكل", "فقدان شهية", "نقص شهية", "عدم رغبة بالأكل"],
    "انسحاب اجتماعي": ["انعزال", "ما اطلع", "ابتعاد عن الناس", "عزلة", "تجنب اجتماعي", "انطواء"],
    "يأس": ["إحباط", "عدم أمل", "تشاؤم", "تشائم", "نظرة سلبية"],
    "تفكير انتحاري": ["أفكار انتحار", "رغبة بالموت", "تمني الموت", "التفكير في إنهاء الحياة"],
    
    # قلق/هلع
    "قلق": ["توتر", "توجس", "خوف مستمر", "على اعصابي", "ترقب", "خوف", "رهبة"],
    "نوبة هلع": ["هجوم هلع", "تسارع قلب", "خفقان", "ضيقه تنفس", "اختناق", "نوبة رعب", "ذعر"],
    "خوف الموت": ["حاس بموت", "بموت", "خايف اموت", "خوف من الموت", "رهبة الموت"],
    "قلق اجتماعي": ["خوف من الناس", "خجل مفرط", "رهبة المسرح", "خوف من التقييم"],
    
    # وسواس
    "وسواس": ["افكار مزعجه", "ملحاحه", "اقتحاميه", "هواجس", "أفكار متكررة", "هوس"],
    "سلوك قهري": ["طقوس", "تكرار غسيل", "تفقد مكرر", "عد قهري", "تنظيف شديد", "إجراءات متكررة"],
    
    # صدمة
    "حدث صادم": ["حادث شديد", "اعتداء", "حرب", "كارثه", "صدمة", "حادث مروع", "تجربة مؤلمة"],
    "استرجاع الحدث": ["فلاش باك", "ذكريات مؤلمه", "كوابيس", "ذكريات مروعة", "تذكر الصدمة"],
    
    # ذهان
    "هلوسة": ["اسمع اصوات", "اشوف اشياء", "هلاوس سمعيه", "هلاوس بصريه", "هذيان", "تهيؤات"],
    "اوهام": ["ضلالات", "افكار غير واقعيه", "شك مرضي", "معتقدات خاطئة", "اعتقادات وهمية"],
    
    # ADHD
    "تشتت": ["عدم تركيز", "سهو", "نسيان", "ما اركز", "شرود ذهني", "قلة انتباه"],
    "فرط حركة": ["كثرة حركه", "اندفاع", "مقاطعه", "ملل سريع", "حركة زائدة", "نشاط مفرط"],
    
    # توحد
    "تواصل اجتماعي ضعيف": ["صعوبه تواصل", "نظره عيون ضعيفه", "علاقات محدوده", "ضعف التفاعل الاجتماعي"],
    "اهتمامات مقيدة": ["روتين صارم", "تكرار حركات", "حساسيات صوت/ضوء", "اهتمامات محدودة"],
    
    # أكل/نوم
    "نهم": ["شراهه", "اكل بكثره", "ما اقدر اوقف اكل", "شره طعام", "تناول مفرط"],
    "تطهير": ["ترجيع متعمد", "استفراغ بعد الاكل", "ملينات", "تطهير ذاتي", "تعمد التقيؤ"],
    
    # ادمان
    "تعاطي": ["استخدام", "ادمان", "اعتماد", "شراهه استخدام", "إساءة استخدام"],
    "انسحاب": ["رجفه", "تعرق", "ارق", "قلق", "أعراض انسحاب", "اعتلال"],
    
    # أعراض جسدية
    "ألم": ["وجع", "آلام", "مشقة جسدية", "أعراض بدنية"],
    "تعب": ["إرهاق", "إنهاك", "وهن", "ضعف"],
}

# ============================= قاعدة DSM موسعة وشاملة =============================
DSM_DB = {
    # ========== الاضطرابات العصبية النمائية ==========
    "إعاقة ذهنية": {
        "keywords": ["ذكاء منخفض", "تأخر نمائي", "صعوبات تعلم شاملة", "اعتماد على الاخرين", "قصور ذهني", "تخلف عقلي"],
        "weight": 1.0,
        "required": ["ذكاء منخفض", "تأخر نمائي"],
        "exclusions": [],
        "prevalence": {"male": 1.5, "female": 1.0},
        "onset_age": "الطفولة"
    },
    "اضطرابات التواصل": {
        "keywords": ["تأخر نطق", "حبسة", "تعثر كلام", "تلعثم", "ضعف لغة", "صعوبة نطق", "عسر كلام"],
        "weight": 1.0,
        "required": ["تأخر نطق", "تعثر كلام"],
        "exclusions": [],
        "prevalence": {"male": 1.8, "female": 1.2},
        "onset_age": "الطفولة"
    },
    "اضطراب طيف التوحد": {
        "keywords": ["تواصل اجتماعي ضعيف", "نظره عين ضعيفه", "سلوك نمطي", "روتين", "حساسيات حسيه", "اهتمامات مقيده", "صعوبة تفاعل اجتماعي"],
        "weight": 1.2,
        "required": ["تواصل اجتماعي ضعيف", "سلوك نمطي"],
        "exclusions": [],
        "prevalence": {"male": 2.5, "female": 1.0},
        "onset_age": "الطفولة المبكرة"
    },
    "اضطراب نقص الانتباه وفرط الحركة": {
        "keywords": ["تشتت", "عدم تركيز", "فرط حركة", "اندفاع", "نسيان", "تأجيل", "تنظيم ضعيف", "صعوبة تركيز"],
        "weight": 1.1,
        "required": ["تشتت", "فرط حركة"],
        "exclusions": [],
        "prevalence": {"male": 2.0, "female": 1.0},
        "onset_age": "الطفولة"
    },
    "اضطراب تعلّم نوعي": {
        "keywords": ["صعوبه قراءه", "ديسلكسيا", "صعوبه حساب", "تهجئه ضعيفه", "بطء تعلم", "صعوبة قراءة", "صعوبة كتابة"],
        "weight": 1.0,
        "required": ["صعوبه قراءه", "بطء تعلم"],
        "exclusions": [],
        "prevalence": {"male": 1.5, "female": 1.0},
        "onset_age": "الطفولة"
    },
    "اضطرابات حركية": {
        "keywords": ["عرات", "تشنجات", "حركات نمطيه", "خلل تناسق", "حركات لا إرادية", "رعشة"],
        "weight": 1.0,
        "required": ["حركات لا إرادية"],
        "exclusions": [],
        "prevalence": {"male": 1.5, "female": 1.0},
        "onset_age": "الطفولة"
    },
    "متلازمة توريت": {
        "keywords": ["عرات حركية", "عرات صوتية", "أصوات لا إرادية", "تفريغ توتر", "لفظ كلمات بذيئة"],
        "weight": 1.3,
        "required": ["عرات حركية", "عرات صوتية"],
        "exclusions": [],
        "prevalence": {"male": 3.0, "female": 1.0},
        "onset_age": "الطفولة"
    },

    # ========== طيف الفصام والذهان ==========
    "ذُهان وجيز": {
        "keywords": ["ذهان حاد", "هلوسه فجائيه", "ضلالات قصيره", "ارتباك شديد", "اضطراب إدراكي حاد"],
        "weight": 1.4,
        "required": ["هلوسه", "ضلالات"],
        "exclusions": [],
        "prevalence": {"male": 1.2, "female": 1.0},
        "onset_age": "أي عمر"
    },
    "فُصام شكلي": {
        "keywords": ["اعراض ذهانيه لا تكفي للفصام", "تدهور اداء", "انسحاب", "أعراض ذهانية تحت العتبة"],
        "weight": 1.2,
        "required": ["اعراض ذهانيه"],
        "exclusions": ["فصام"],
        "prevalence": {"male": 1.2, "female": 1.0},
        "onset_age": "المراهقة المبكرة"
    },
    "فصام": {
        "keywords": ["هلوسة", "اوهام", "ضلالات", "تفكير غير منظم", "تسطح وجداني", "انسحاب اجتماعي", "انعدام اراده", "اضطراب تفكير"],
        "weight": 1.8,
        "required": ["هلوسة", "اوهام"],
        "exclusions": [],
        "prevalence": {"male": 1.4, "female": 1.0},
        "onset_age": "المراهقة المتأخرة - البلوغ المبكر"
    },
    "اضطراب فصامي عاطفي": {
        "keywords": ["اعراض ذهانيه", "اكتئاب شديد او هوس", "تذبذب مزاج", "أعراض مزاجية وذهانية"],
        "weight": 1.6,
        "required": ["اعراض ذهانيه", "اكتئاب شديد او هوس"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 1.0},
        "onset_age": "البلوغ"
    },
    "اضطراب وهامي": {
        "keywords": ["ضلالات ثابته", "غيرة وهامية", "اضطهاد", "عظمة", "شك مرضي", "ضلالات ثابتة"],
        "weight": 1.5,
        "required": ["ضلالات ثابته"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 1.5},
        "onset_age": "منتصف العمر"
    },

    # ========== الاضطرابات ثنائية القطب ==========
    "اضطراب ثنائي القطب I": {
        "keywords": ["نوبة هوس", "طاقة عالية", "قليل نوم", "اندفاع", "تهور", "افكار سباق", "هوس كامل", "نوبات اكتئاب"],
        "weight": 1.7,
        "required": ["نوبة هوس", "نوبات اكتئاب"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 1.0},
        "onset_age": "المراهقة المتأخرة - البلوغ المبكر"
    },
    "اضطراب ثنائي القطب II": {
        "keywords": ["هوس خفيف", "طاقة عالية", "قليل نوم", "اندفاع", "نوبات اكتئاب", "هيبومانيا"],
        "weight": 1.6,
        "required": ["هوس خفيف", "نوبات اكتئاب"],
        "exclusions": ["نوبة هوس"],
        "prevalence": {"male": 1.0, "female": 1.2},
        "onset_age": "البلوغ"
    },
    "اضطراب دوروية المزاج": {
        "keywords": ["تقلبات مزاج مزمنة", "نوبات تحت عتبة", "عدم استقرار مزاج", "تقلبات مزاجية متكررة"],
        "weight": 1.3,
        "required": ["تقلبات مزاج مزمنة"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 1.0},
        "onset_age": "المراهقة - البلوغ المبكر"
    },

    # ========== الاضطرابات الاكتئابية ==========
    "اضطراب اكتئابي جسيم": {
        "keywords": [
            "حزن", "مزاج منخفض", "انعدام المتعة", "فقدان المتعة", "تشاؤم", "تفكير سلبي", "بكاء", "انسحاب اجتماعي",
            "طاقة منخفضة", "ارهاق", "تعب", "خمول", "كسل", "بطء نفسي حركي",
            "اضطراب نوم", "قلة نوم", "كثرة نوم", "ارق", "نوم متقطع", "استيقاظ مبكر",
            "شهية منخفضة", "قلة اكل", "فقدان شهية", "فقدان وزن", "زيادة وزن",
            "تركيز ضعيف", "احتقار الذات", "شعور بالذنب", "يأس", "افكار انتحارية", "انتحار", "اكتئاب حاد"
        ],
        "weight": 1.8,
        "required": ["حزن", "انعدام المتعة"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 2.0},
        "onset_age": "أي عمر (ذروة في العشرينات)"
    },
    "اكتئاب مستمر (عسر المزاج)": {
        "keywords": ["مزاج مكتئب مزمن", "تشاؤم مزمن", "طاقة قليلة", "نوم ضعيف", "شهية قليلة", "ثقة منخفضة", "انتاجية ضعيفه", "اكتئاب مزمن"],
        "weight": 1.5,
        "required": ["مزاج مكتئب مزمن"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 2.0},
        "onset_age": "المراهقة - البلوغ المبكر"
    },
    "اضطراب ما قبل الطمث المزعج": {
        "keywords": ["تقلب مزاج قبل الدوره", "تهيج", "حساسيه", "انتفاخ", "شهية", "غضب", "حزن قبل الحيض", "توتر ما قبل الطمث"],
        "weight": 1.3,
        "required": ["تقلب مزاج قبل الدوره"],
        "exclusions": [],
        "prevalence": {"male": 0.0, "female": 1.0},
        "onset_age": "سن الإنجاب"
    },
    "اكتئاب ما حول الولادة": {
        "keywords": ["بعد الولاده", "حزن ما بعد الولاده", "بكاء", "قلق طفل", "نوم مضطرب", "اكتئاب ما بعد الولادة"],
        "weight": 1.4,
        "required": ["بعد الولاده", "حزن ما بعد الولاده"],
        "exclusions": [],
        "prevalence": {"male": 0.0, "female": 1.0},
        "onset_age": "بعد الولادة"
    },

    # ========== اضطرابات القلق ==========
    "اضطراب القلق العام": {
        "keywords": ["قلق", "قلق مفرط", "توتر", "توجس", "افكار سلبية", "شد عضلي", "صعوبة تركيز", "قابلية استفزاز", "ارق", "تعب", "توتر عام"],
        "weight": 1.4,
        "required": ["قلق مفرط"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 2.0},
        "onset_age": "المراهقة - البلوغ"
    },
    "اضطراب الهلع": {
        "keywords": ["نوبة هلع", "خفقان", "اختناق", "ضيق نفس", "تعرق", "رجفة", "دوار", "خوف الموت", "خوف فقدان السيطرة", "غثيان", "خدر", "نوبة ذعر"],
        "weight": 1.6,
        "required": ["نوبة هلع"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 2.5},
        "onset_age": "البلوغ المبكر"
    },
    "رهاب الساحة": {
        "keywords": ["خوف من الاماكن المفتوحه", "خوف من الازدحام", "تجنب مواصلات", "صعوبه الخروج وحيدا", "خوف الأماكن العامة"],
        "weight": 1.4,
        "required": ["خوف من الاماكن المفتوحه"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 2.0},
        "onset_age": "المراهقة المتأخرة - البلوغ المبكر"
    },
    "رهاب اجتماعي": {
        "keywords": ["خوف اجتماعي", "خوف التقييم", "خجل شديد", "تجنب اجتماعي", "قلق اداء", "احمرار", "قلق اجتماعي"],
        "weight": 1.4,
        "required": ["خوف اجتماعي"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 1.5},
        "onset_age": "المراهقة"
    },
    "رهاب محدد": {
        "keywords": ["خوف شديد", "تجنب مواقف", "خوف طيران", "خوف حشرات", "خوف المرتفعات", "خوف الظلام", "فوبيا"],
        "weight": 1.3,
        "required": ["خوف شديد"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 2.0},
        "onset_age": "الطفولة"
    },
    "قلق انفصالي (بالغ)": {
        "keywords": ["قلق انفصال", "صعوبة ابتعاد", "كابوس فقد", "اعراض جسدية عند الفراق", "خوف الانفصال"],
        "weight": 1.3,
        "required": ["قلق انفصال"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 1.5},
        "onset_age": "الطفولة أو البلوغ"
    },
    "خرس اختياري": {
        "keywords": ["سكوت انتقائي", "لا يتكلم بمواقف اجتماعية", "قلق كلام", "صمت اختياري"],
        "weight": 1.2,
        "required": ["سكوت انتقائي"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 1.0},
        "onset_age": "الطفولة"
    },

    # ========== الوسواس القهري وما يرتبط به ==========
    "اضطراب الوسواس القهري": {
        "keywords": ["وسواس", "افكار اقتحاميه", "سلوك قهري", "طقوس", "تفقد متكرر", "غسل متكرر", "تنظيم مفرط", "عد قهري", "خوف تلوث", "وسواس قهري"],
        "weight": 1.7,
        "required": ["وسواس", "سلوك قهري"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 1.0},
        "onset_age": "المراهقة - البلوغ المبكر"
    },
    "تشوه صورة الجسد": {
        "keywords": ["انشغال بالمظهر", "عيوب متخيله", "تفقد المرآه", "تعديل مظهر مفرط", "اضطراب صورة الجسد"],
        "weight": 1.5,
        "required": ["انشغال بالمظهر"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 1.5},
        "onset_age": "المراهقة"
    },
    "اكتناز": {
        "keywords": ["اكتناز", "صعوبة رمي", "تكديس", "فوضى منزل", "تخزين قهري"],
        "weight": 1.4,
        "required": ["اكتناز"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 1.5},
        "onset_age": "المراهقة - البلوغ المبكر"
    },
    "اضطراب نتف الشعر": {
        "keywords": ["شد شعر", "سحب شعر", "فراغات شعر", "توتر ثم ارتياح", "نتف شعر قهري"],
        "weight": 1.4,
        "required": ["شد شعر"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 2.0},
        "onset_age": "المراهقة"
    },
    "اضطراب قشط الجلد": {
        "keywords": ["قشط جلد", "خدش متكرر", "جروح صغيرة متكررة", "تقشير الجلد"],
        "weight": 1.3,
        "required": ["قشط جلد"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 2.0},
        "onset_age": "المراهقة"
    },

    # ========== صدمة وضغوط ==========
    "اضطراب ما بعد الصدمة": {
        "keywords": ["حدث صادم", "استرجاع الحدث", "فلاش باك", "كابوس", "تجنب", "خدر عاطفي", "يقظه مفرطه", "حساسيه صوت", "صدمة نفسية"],
        "weight": 1.8,
        "required": ["حدث صادم", "استرجاع الحدث"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 2.0},
        "onset_age": "أي عمر"
    },
    "اضطراب كرب حاد": {
        "keywords": ["اعراض صدمة قصيرة", "خلال اسابيع", "يقظه مفرطه", "تجنب", "اضطراب ضغط حاد"],
        "weight": 1.5,
        "required": ["اعراض صدمة قصيرة"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 1.5},
        "onset_age": "أي عمر"
    },
    "اضطراب تكيف": {
        "keywords": ["توتر موقف", "حزن بعد حدث", "قلق ظرفي", "تراجع اداء بعد ضغط", "اضطراب تأقلم"],
        "weight": 1.3,
        "required": ["توتر موقف"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 1.5},
        "onset_age": "أي عمر"
    },
    "اضطراب ارتباط تفاعلي (اطفال)": {
        "keywords": ["تجنب ارتباط", "سلوك منسحب", "إهمال سابق", "اضطراب التعلق"],
        "weight": 1.4,
        "required": ["تجنب ارتباط"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 1.0},
        "onset_age": "الطفولة المبكرة"
    },

    # ========== انفصامية ==========
    "اضطراب الهوية الانفصامي": {
        "keywords": ["هويات متعددة", "فقدان ذاكرة فواصل", "ضياع وقت", "تعدد الشخصيات"],
        "weight": 1.7,
        "required": ["هويات متعددة"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 3.0},
        "onset_age": "الطفولة"
    },
    "اضطراب تبدد الشخصية/الواقع": {
        "keywords": ["شعور باللاتواقعية", "انفصال عن الذات", "غربة الواقع", "تبدد الشخصية"],
        "weight": 1.5,
        "required": ["شعور باللاتواقعية"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 1.0},
        "onset_age": "المراهقة - البلوغ"
    },
    "فقدان ذاكرة انفصالي": {
        "keywords": ["نوبات نسيان احداث صادمة", "ثقوب ذاكرة", "فقدان ذاكرة نفسي"],
        "weight": 1.4,
        "required": ["نوبات نسيان"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 2.0},
        "onset_age": "أي عمر"
    },

    # ========== أعراض جسدية ==========
    "اضطراب الأعراض الجسدية": {
        "keywords": ["الم غير مفسر", "اعراض جسدية متعدده", "انشغال صحي", "زياره اطباء كثيره", "قلق صحي"],
        "weight": 1.5,
        "required": ["الم غير مفسر"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 2.0},
        "onset_age": "المراهقة - البلوغ"
    },
    "قلق المرض": {
        "keywords": ["خوف مرض خطير", "تفقد جسد", "طمأنه متكرره", "بحث طبي مستمر", "توهم المرض"],
        "weight": 1.5,
        "required": ["خوف مرض خطير"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 1.0},
        "onset_age": "البلوغ المبكر"
    },
    "اضطراب تحولي (تحويل)": {
        "keywords": ["اعراض عصبية بدون سبب عضوي", "شلل وظيفي", "نوبات غير صرعية", "هستيريا تحويلية"],
        "weight": 1.5,
        "required": ["اعراض عصبية بدون سبب عضوي"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 2.0},
        "onset_age": "المراهقة - البلوغ"
    },
    "اضطراب اضطراب مصطنع": {
        "keywords": ["تزييف اعراض", "اصابه متعمده", "بحث رعاية طبية", "اضطراب مفتعل"],
        "weight": 1.4,
        "required": ["تزييف اعراض"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 1.0},
        "onset_age": "البلوغ المبكر"
    },

    # ========== أكل ==========
    "قهم عصبي": {
        "keywords": ["نقص وزن شديد", "خوف من زياده الوزن", "صورة جسد سلبيه", "تقييد طعام", "فقدان الشهية العصبي"],
        "weight": 1.7,
        "required": ["نقص وزن شديد", "خوف من زياده الوزن"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 10.0},
        "onset_age": "المراهقة"
    },
    "نهام عصبي": {
        "keywords": ["نهم متكرر", "تطهير", "استفراغ", "ملينات", "ذنب بعد الاكل", "الشره العصبي"],
        "weight": 1.6,
        "required": ["نهم متكرر", "تطهير"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 3.0},
        "onset_age": "المراهقة المتأخرة - البلوغ المبكر"
    },
    "اضطراب نهم الطعام": {
        "keywords": ["نهم", "اكل بشراهه", "فقدان تحكم", "اكل سرا", "زيادة وزن", "شراهة الطعام"],
        "weight": 1.5,
        "required": ["نهم", "فقدان تحكم"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 1.5},
        "onset_age": "البلوغ"
    },
    "اضطراب تجنّبي/مقيّد": {
        "keywords": ["انتقائيه طعام", "تجنب قوام/روائح", "نقص تغذيه", "اضطراب تناول الطعام"],
        "weight": 1.3,
        "required": ["انتقائيه طعام"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 1.0},
        "onset_age": "الطفولة"
    },

    # ========== إطراح ==========
    "سلس بولي (تبول ليلي)": {
        "keywords": ["تبول ليلي", "تبوّل لاإرادي", "فوق سن 5", "تبول لا إرادي"],
        "weight": 1.3,
        "required": ["تبول ليلي"],
        "exclusions": [],
        "prevalence": {"male": 1.5, "female": 1.0},
        "onset_age": "الطفولة"
    },
    "تبول نهاري": {
        "keywords": ["تبول نهاري لاإرادي", "تسرّب بول", "سلس بول نهاري"],
        "weight": 1.2,
        "required": ["تبول نهاري لاإرادي"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 1.0},
        "onset_age": "الطفولة"
    },
    "تغوّط لاإرادي": {
        "keywords": ["تلويث برازي", "حوادث براز", "سلس براز"],
        "weight": 1.3,
        "required": ["تلويث برازي"],
        "exclusions": [],
        "prevalence": {"male": 1.5, "female": 1.0},
        "onset_age": "الطفولة"
    },

    # ========== نوم ويقظة ==========
    "أرق مزمن": {
        "keywords": ["صعوبه نوم", "استيقاظ مبكر", "نوم متقطع", "عدم راحه", "اجهاد نهاري", "أرق"],
        "weight": 1.4,
        "required": ["صعوبه نوم"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 1.5},
        "onset_age": "البلوغ"
    },
    "فرط نعاس/نوم": {
        "keywords": ["نعاس نهاري", "غفوات متكررة", "نوم مفرط", "خمول نهاري"],
        "weight": 1.3,
        "required": ["نعاس نهاري"],
        "exclusions": [],
        "prevalence": {"male": 1.0, "female": 1.5},
        "onset_age": "المراهقة - البلوغ"
    },
    "ناركوليبسي": {
        "keywords": ["نوم مفاجئ", "شلل نوم", "هلوسات نعاس", "نوم قهري"],
        "weight":

# -*- coding: utf-8 -*-
"""
اختبارات نفسية (نماذج أساسية)
"""

from typing import Dict, List, Any

# =========================================================
# أمثلة لاختبارات نفسية (بسيطة كبداية)
# =========================================================

PSYCH_TESTS: Dict[str, Dict[str, Any]] = {
    "gad7": {
        "title": "مقياس القلق العام (GAD-7)",
        "items": [
            {"id": 1, "text": "شعرت بالعصبية أو التوتر أو القلق"},
            {"id": 2, "text": "لم أستطع التوقف عن القلق أو التحكم فيه"},
            {"id": 3, "text": "قلقت كثيرًا بشأن أشياء مختلفة"},
            {"id": 4, "text": "واجهت صعوبة في الاسترخاء"},
            {"id": 5, "text": "شعرت بالانزعاج أو العصبية بسهولة"},
            {"id": 6, "text": "شعرت بالخوف كأن شيئًا سيئًا قد يحدث"},
            {"id": 7, "text": "واجهت صعوبة في النوم أو البقاء نائمًا"},
        ],
        "scale": {
            0: "أبداً",
            1: "عدة أيام",
            2: "أكثر من نصف الأيام",
            3: "تقريباً كل يوم"
        },
        "cutoffs": {
            "خفيف": (5, 9),
            "متوسط": (10, 14),
            "شديد": (15, 21)
        }
    },
    "phq9": {
        "title": "مقياس الاكتئاب (PHQ-9)",
        "items": [
            {"id": 1, "text": "قلة الاهتمام أو المتعة بالقيام بالأشياء"},
            {"id": 2, "text": "الشعور بالإحباط أو اليأس"},
            {"id": 3, "text": "صعوبة في النوم أو النوم الكثير"},
            {"id": 4, "text": "الشعور بالتعب أو قلة الطاقة"},
            {"id": 5, "text": "قلة الشهية أو الإفراط في الأكل"},
            {"id": 6, "text": "الشعور بعدم الرضا عن نفسك أو الفشل"},
            {"id": 7, "text": "صعوبة التركيز"},
            {"id": 8, "text": "الحركة أو الكلام ببطء شديد أو العكس"},
            {"id": 9, "text": "أفكار بأنك تود الموت أو إيذاء نفسك"},
        ],
        "scale": {
            0: "أبداً",
            1: "عدة أيام",
            2: "أكثر من نصف الأيام",
            3: "تقريباً كل يوم"
        },
        "cutoffs": {
            "خفيف": (5, 9),
            "متوسط": (10, 14),
            "شديد": (15, 27)
        }
    }
}

# =========================================================
# دوال التصحيح
# =========================================================

def score_test(test_key: str, answers: Dict[int, int]) -> Dict[str, Any]:
    test = PSYCH_TESTS.get(test_key)
    if not test:
        return {"error": "اختبار غير معروف"}
    total = sum(answers.values())
    severity = "بدون" 
    for level, (low, high) in test["cutoffs"].items():
        if low <= total <= high:
            severity = level
            break
    return {"total": total, "severity": severity, "answers": answers}

def get_scale_options(test_key: str) -> Dict[int, str]:
    test = PSYCH_TESTS.get(test_key)
    return test.get("scale", {}) if test else {}

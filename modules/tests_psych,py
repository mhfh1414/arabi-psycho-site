# -*- coding: utf-8 -*-
"""
اختبارات نفسية (Psychological Tests)
هذا الملف يحتوي على اختبارات نفسية قياسية مع بيانات مبسطة.
"""

from typing import Dict, Any, List

# =====================================================
# قاعدة بيانات مبسطة للاختبارات النفسية
# =====================================================

PSYCH_TESTS: Dict[str, Dict[str, Any]] = {
    "bdi": {
        "name": "مقياس بيك للاكتئاب",
        "questions": [
            "أشعر بالحزن معظم الوقت",
            "لا أستمتع بالأنشطة كما في السابق",
            "أشعر بالذنب كثيرًا",
            "أفكر بالموت أو الانتحار"
        ],
        "scale": [0, 1, 2, 3],
        "interpretation": {
            "0-13": "اكتئاب بسيط أو غائب",
            "14-19": "اكتئاب خفيف",
            "20-28": "اكتئاب متوسط",
            "29-63": "اكتئاب شديد"
        }
    },
    "gad7": {
        "name": "مقياس القلق العام GAD-7",
        "questions": [
            "أشعر بالتوتر أو العصبية أو القلق",
            "لا أستطيع السيطرة على القلق",
            "أقلق كثيرًا بشأن أمور مختلفة",
            "أجد صعوبة في الاسترخاء",
            "أشعر بالانزعاج بسهولة",
            "أشعر بالخوف كما لو أن شيئًا سيئًا سيحدث"
        ],
        "scale": [0, 1, 2, 3],
        "interpretation": {
            "0-4": "قلق طبيعي",
            "5-9": "قلق خفيف",
            "10-14": "قلق متوسط",
            "15-21": "قلق شديد"
        }
    }
}

# =====================================================
# دوال مساعدة
# =====================================================

def list_tests() -> List[str]:
    """إرجاع قائمة أسماء الاختبارات المتاحة"""
    return list(PSYCH_TESTS.keys())

def get_test(test_key: str) -> Dict[str, Any]:
    """إرجاع بيانات اختبار محدد"""
    return PSYCH_TESTS.get(test_key, {})

def score_test(test_key: str, answers: List[int]) -> Dict[str, Any]:
    """
    حساب النتيجة لاختبار معين.
    - test_key: مفتاح الاختبار (مثل bdi, gad7)
    - answers: قائمة الدرجات التي أجابها المستخدم
    """
    test = PSYCH_TESTS.get(test_key)
    if not test:
        return {"error": "اختبار غير موجود"}

    total = sum(answers)
    interpretation = "غير محدد"

    # البحث في جدول التفسير
    for rng, meaning in test["interpretation"].items():
        low, high = map(int, rng.split("-"))
        if low <= total <= high:
            interpretation = meaning
            break

    return {
        "test": test["name"],
        "total": total,
        "interpretation": interpretation
    }

# =====================================================
# اختبار سريع عند التشغيل المباشر
# =====================================================
if __name__ == "__main__":
    print("الاختبارات المتاحة:", list_tests())
    result = score_test("bdi", [1, 2, 0, 3])
    print("نتيجة BDI:", result)

<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>DSM â€” Ù…Ø±Ø¬Ø¹ Ø§Ù„Ø§Ø¶Ø·Ø±Ø§Ø¨Ø§Øª + Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶</title>
<style>
  :root{
    --bg:#0f2347; --ink:#eef3ff; --muted:#cbd5e1;
    --card:#123a7acc; --card2:#0c2a59cc; --accent:#f5b546;
    --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444; --chip:#14366f;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:"Tajawal","Noto Kufi Arabic",Tahoma,Arial,sans-serif;
       background: radial-gradient(1000px 700px at 80% -10%, #1b4da0 0%, #0f2347 55%) fixed; color:var(--ink); line-height:1.9}
  .wrap{max-width:1180px;margin:auto;padding:22px}
  h1{margin:0 0 8px;font-size:clamp(22px,3vw,32px)}
  .sub{color:var(--muted);font-size:13px;margin-top:-6px}
  .grid{display:grid;gap:14px;grid-template-columns:repeat(12,1fr)}
  .card{grid-column:span 12;background:linear-gradient(180deg,var(--card),var(--card2));
        border:1px solid #ffffff1a;border-radius:18px;padding:16px;backdrop-filter:blur(6px);box-shadow:0 8px 22px #0005}
  @media (min-width:960px){ .sm{grid-column:span 6} }
  label{display:block;margin:6px 0 6px;font-weight:700}
  input, textarea, select{
    width:100%;background:#0a1b3b;border:1px solid #ffffff22;color:#fff;
    border-radius:10px;padding:10px;font-size:15px;outline:none
  }
  textarea{min-height:90px;resize:vertical}
  .btn{background:linear-gradient(180deg,#1e3a8a,#0b1c3e);color:#fff;border:1px solid #ffffff22;
       border-radius:12px;padding:12px 16px;font-weight:800;cursor:pointer}
  .btn:active{transform:translateY(1px)}
  .btn.alt{background:linear-gradient(180deg,#15803d,#0b3e1b)}
  .badge{background:var(--chip);border:1px solid #ffffff22;color:#dbe6ff;border-radius:999px;padding:4px 10px;font-size:12px}
  .results h2{margin:0 0 10px}
  .item{border:1px solid #ffffff1a;border-radius:14px;padding:12px;margin:10px 0;background:#0b1f49cc}
  .bar{height:9px;background:#ffffff18;border-radius:999px;overflow:hidden}
  .bar>i{display:block;height:100%;width:0;background:linear-gradient(90deg,#22c55e,#f59e0b,#ef4444)}
  .pill{display:inline-block;background:#14366f;border:1px solid #ffffff22;color:#dbe6ff;border-radius:999px;padding:6px 10px;font-size:12px;margin:3px 5px 0 0}
  details{border:1px solid #ffffff12;border-radius:14px;padding:10px 12px;background:#0a1e45cc}
  details summary{cursor:pointer;font-weight:800}
  .warn{color:var(--warn)} .bad{color:var(--bad)} .ok{color:var(--ok)}
  .muted{color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <header style="margin-bottom:14px">
    <h1>Ù…Ø±Ø¬Ø¹ Ø§Ù„Ø§Ø¶Ø·Ø±Ø§Ø¨Ø§Øª (Ù†Ù…Ø· DSM) + Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶</h1>
    <div class="sub">ØµÙŠØ§ØºØ© Ù…Ø¨Ø³Ù‘Ø·Ø© ÙˆØºÙŠØ± Ù…Ù†Ø³ÙˆØ®Ø© Ø­Ø±ÙÙŠÙ‹Ø§. Ø£Ø¯Ø§Ø© Ø¯Ø¹Ù… ÙˆÙ„ÙŠØ³Øª ØªØ´Ø®ÙŠØµÙ‹Ø§ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§.</div>
  </header>

  <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ -->
  <section class="grid">
    <div class="card sm">
      <h2>ğŸ“ Ø¯Ø±Ø§Ø³Ø© Ø­Ø§Ù„Ø© Ø³Ø±ÙŠØ¹Ø©</h2>
      <label>Ø§Ù„Ø§Ø³Ù…</label>
      <input id="name" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ">
      <div class="grid" style="gap:10px">
        <div class="sm">
          <label>Ø§Ù„Ø¹Ù…Ø±</label>
          <input id="age" type="number" min="1" placeholder="Ù…Ø«Ø§Ù„: 30">
        </div>
        <div class="sm">
          <label>Ø§Ù„Ø¬Ù†Ø³</label>
          <select id="gender"><option value="">â€” Ø§Ø®ØªØ± â€”</option><option>Ø°ÙƒØ±</option><option>Ø£Ù†Ø«Ù‰</option><option>Ø¢Ø®Ø±</option></select>
        </div>
      </div>
      <label>Ù…Ø¯Ù‘Ø© Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ (Ø¨Ø§Ù„Ø£ÙŠØ§Ù…)</label>
      <input id="duration" type="number" min="0" placeholder="Ù…Ø«Ø§Ù„: 30">
    </div>
    <div class="card sm">
      <h2>ğŸ§­ ÙˆØµÙ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶</h2>
      <label>ØµÙ Ø£Ø¹Ø±Ø§Ø¶Ùƒ Ø¨Ø­Ø±Ù‘ÙŠØ©</label>
      <textarea id="symptoms" placeholder="Ø£Ù…Ø«Ù„Ø©: Ø­Ø²Ù† Ø´Ø¯ÙŠØ¯ØŒ ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ù…ØªØ¹Ø©ØŒ Ø£Ø±Ù‚ØŒ Ù‚Ù„Ù‚ Ù…Ø³ØªÙ…Ø±ØŒ Ù†ÙˆØ¨Ø§Øª Ù‡Ù„Ø¹ØŒ ÙˆØ³ÙˆØ§Ø³ ÙˆØºØ³Ù„ Ù…ØªÙƒØ±Ø±ØŒ ÙƒÙˆØ§Ø¨ÙŠØ³ Ø¨Ø¹Ø¯ Ø­Ø§Ø¯Ø«..."></textarea>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px">
        <button class="btn" onclick="analyze()">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶</button>
        <button class="btn alt" onclick="resetForm()">Ù…Ø³Ø­ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª</button>
        <span class="badge">Ù„Ù† ÙŠØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ</span>
      </div>
    </div>
  </section>

  <!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
  <section id="results" class="card results" style="margin-top:14px;display:none">
    <h2>ğŸ¯ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©</h2>
    <div id="flags" class="muted" style="margin:-6px 0 8px"></div>
    <div id="list"></div>
    <div class="muted" style="margin-top:8px">
      âš ï¸ Ù‡Ø°Ù‡ Ù†ØªØ§Ø¦Ø¬ Ø¥Ø±Ø´Ø§Ø¯ÙŠØ©. Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ø®Ø·Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙØ³ Ø£Ùˆ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø·Ù„Ø¨ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¹Ø§Ø¬Ù„Ø©.
    </div>
  </section>

  <!-- Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø£Ù…Ø±Ø§Ø¶ (Ù…Ø®ØªØµØ±Ø§Øª ÙˆØ£Ø¹Ø±Ø§Ø¶ Ø´Ø§Ø¦Ø¹Ø© ØºÙŠØ± Ù…Ù†Ø³ÙˆØ®Ø©) -->
  <section class="card" style="margin-top:14px">
    <h2>ğŸ“š Ù…Ø±Ø¬Ø¹ Ø§Ù„Ø§Ø¶Ø·Ø±Ø§Ø¨Ø§Øª (Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©)</h2>
    <p class="muted">Ù‚Ø§Ø¦Ù…Ø© Ø´Ø§Ù…Ù„Ø© Ù…Ø¨Ø³Ù‘Ø·Ø© Ù„ØªØºØ·ÙŠØ© Ù…Ø¹Ø¸Ù… Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©ØŒ Ù…ØµÙ†Ù‘ÙØ© Ø¨Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø§Øª.</p>

    <!-- Ø³Ù†ÙˆÙ„Ù‘Ø¯ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ø±Ù…Ø¬ÙŠÙ‹Ø§ Ù…Ù† ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ -->
    <div id="catalog"></div>
  </section>
</div>

<script>
/* ============ ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ (ØºÙŠØ± Ù…Ù†Ø³ÙˆØ®Ø© Ø­Ø±ÙÙŠÙ‹Ø§) ============ */
const RULES = [
  // Ø§Ù„Ù…Ø²Ø§Ø¬
  { code:'MDE', name:'Ù†ÙˆØ¨Ø© Ø§ÙƒØªØ¦Ø§Ø¨ÙŠØ© ÙƒØ¨Ø±Ù‰', group:'Ø§Ù„Ù…Ø²Ø§Ø¬', min:5, core:['Ø­Ø²Ù†','ÙƒØ¢Ø¨Ø©','Ù…Ø²Ø§Ø¬ Ù…Ù†Ø®ÙØ¶','ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ù…ØªØ¹Ø©','Ø¹Ø¯Ù… Ø§Ø³ØªÙ…ØªØ§Ø¹'], durationMin:14,
    keys:['Ø­Ø²Ù†','ÙƒØ¢Ø¨Ø©','ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ù…ØªØ¹Ø©','Ø¹Ø¯Ù… Ø§Ø³ØªÙ…ØªØ§Ø¹','Ø£Ø±Ù‚','Ù†ÙˆÙ… Ù‚Ù„ÙŠÙ„','Ù†Ø¹Ø§Ø³ Ø²Ø§Ø¦Ø¯','Ø´Ù‡ÙŠØ© Ù…Ù†Ø®ÙØ¶Ø©','ÙÙ‚Ø¯Ø§Ù† ÙˆØ²Ù†','Ø´Ù‡ÙŠØ© Ø²Ø§Ø¦Ø¯Ø©','ØªØ¨Ø§Ø·Ø¤','Ø¥Ø«Ø§Ø±Ø© Ù†ÙØ³ÙŠØ© Ø­Ø±ÙƒÙŠØ©','Ø¥Ø±Ù‡Ø§Ù‚','Ø·Ø§Ù‚Ø© Ù…Ù†Ø®ÙØ¶Ø©','Ø°Ù†Ø¨','Ø¹Ø¯ÙŠÙ… Ø§Ù„Ù‚ÙŠÙ…Ø©','Ù„ÙˆÙ… Ø§Ù„Ø°Ø§Øª','ØµØ¹ÙˆØ¨Ø© ØªØ±ÙƒÙŠØ²','ØªØ´ØªØª','Ø¨Ø·Ø¡ Ø§Ù„ØªÙÙƒÙŠØ±','Ø£ÙÙƒØ§Ø± Ø§Ù†ØªØ­Ø§Ø±','ØªÙ…Ù†ÙŠ Ø§Ù„Ù…ÙˆØª'],
    red:['Ø§Ù†ØªØ­Ø§Ø±','Ø£Ø¤Ø°ÙŠ Ù†ÙØ³ÙŠ','Ù‚ØªÙ„ Ù†ÙØ³ÙŠ'],
    tips:['Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø³Ù„ÙˆÙƒÙŠ Ø§Ù„Ù…Ø¹Ø±ÙÙŠ Ù…ÙÙŠØ¯','Ø§Ø³ØªØ´Ø§Ø±Ø© Ù…Ø®ØªØµ Ø¹Ù†Ø¯ Ø§Ø´ØªØ¯Ø§Ø¯ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶'] },

  { code:'PDD', name:'Ø§ÙƒØªØ¦Ø§Ø¨ Ù…Ø³ØªÙ…Ø± (Ù…Ø²Ù…Ù†)', group:'Ø§Ù„Ù…Ø²Ø§Ø¬', min:2, core:['Ù…Ø²Ø§Ø¬ Ù…Ù†Ø®ÙØ¶'], durationMin:365*2,
    keys:['Ù…Ø²Ø§Ø¬ Ù…Ù†Ø®ÙØ¶','ÙÙ‚Ø¯Ø§Ù† Ø´Ù‡ÙŠØ© or Ø²ÙŠØ§Ø¯Ø©','Ù†ÙˆÙ… Ø²Ø§Ø¦Ø¯ or Ø£Ø±Ù‚','Ø·Ø§Ù‚Ø© Ù…Ù†Ø®ÙØ¶Ø©','ØªÙ‚Ø¯ÙŠØ± Ø°Ø§Øª Ù…ØªØ¯Ù†','ØªØ±ÙƒÙŠØ² Ø¶Ø¹ÙŠÙ','ØªØ±Ø¯Ø¯'],
    red:[], tips:['ØªØªØ¨Ù‘Ø¹ Ø§Ù„Ù…Ø²Ø§Ø¬ ÙˆØ§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù†ÙØ³ÙŠ'] },

  { code:'MANIA', name:'Ù‡ÙˆØ³ (Ø«Ù†Ø§Ø¦ÙŠ Ø§Ù„Ù‚Ø·Ø¨)', group:'Ø§Ù„Ù…Ø²Ø§Ø¬', min:3, core:['Ù…Ø²Ø§Ø¬ Ù…Ø±ØªÙØ¹','Ù‡ÙŠØ¬Ø§Ù† ØºÙŠØ± Ù…Ø¹ØªØ§Ø¯','Ø·Ø§Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©'], durationMin:7,
    keys:['Ø«Ù‚Ø© Ù…ÙØ±Ø·Ø©','Ù‚Ù„Ø© Ø­Ø§Ø¬Ø© Ù„Ù„Ù†ÙˆÙ…','ÙƒÙ„Ø§Ù… ÙƒØ«ÙŠØ±','Ø«Ø±Ø«Ø±Ø©','Ø£ÙÙƒØ§Ø± Ø³Ø¨Ø§Ù‚','ØªØ´ØªÙŠØª Ø³Ø±ÙŠØ¹','Ø§Ù†Ø¯ÙØ§Ø¹','Ù…Ø®Ø§Ø·Ø±Ø© Ù…Ø§Ù„ÙŠØ©','Ø³Ù„ÙˆÙƒ Ø¬Ù†Ø³ÙŠ Ù…ØªÙ‡ÙˆØ±'],
    red:['Ø§Ù†Ø¯ÙØ§Ø¹ Ø®Ø·ÙŠØ±','Ù…Ø®Ø§Ø·Ø±Ø© Ø´Ø¯ÙŠØ¯Ø©'], tips:['ØªÙ‚ÙŠÙ€ÙŠÙ… Ø·Ø¨ÙŠØ¨ Ù†ÙØ³ÙŠ Ø¶Ø±ÙˆØ±ÙŠ'] },

  // Ø§Ù„Ù‚Ù„Ù‚
  { code:'GAD', name:'Ù‚Ù„Ù‚ Ù…Ø¹Ù…Ù‘Ù…', group:'Ø§Ù„Ù‚Ù„Ù‚', min:3, core:['Ù‚Ù„Ù‚','ØªÙˆØªØ±','Ø®ÙˆÙ Ù…Ø³ØªÙ…Ø±'], durationMin:180,
    keys:['ØªÙˆØªØ±','Ø¹ØµØ¨ÙŠØ©','ØªØ¹Ø¨','Ø¥Ø±Ù‡Ø§Ù‚','ØµØ¹ÙˆØ¨Ø© ØªØ±ÙƒÙŠØ²','ØªØ´ØªÙŠØª','Ø´Ø¯ Ø¹Ø¶Ù„ÙŠ','Ø£Ø±Ù‚','ØµØ­Ùˆ Ù…ØªÙƒØ±Ø±','Ù‚Ù„Ù‚ Ø¹Ù„Ù‰ Ø£Ø´ÙŠØ§Ø¡ ÙƒØ«ÙŠØ±Ø©','Ù‚Ù„Ù‚ Ù…ÙØ±Ø·'],
    red:[], tips:['ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡ ÙˆCBT ÙØ¹Ù‘Ø§Ù„Ø©'] },

  { code:'PANIC', name:'Ù†ÙˆØ¨Ø§Øª Ù‡Ù„Ø¹', group:'Ø§Ù„Ù‚Ù„Ù‚', min:4, core:['Ù†ÙˆØ¨Ø©','Ù‡Ù„Ø¹','Ø®ÙˆÙ Ø´Ø¯ÙŠØ¯ ÙØ¬Ø£Ø©'], durationMin:0,
    keys:['Ø®ÙÙ‚Ø§Ù†','Ø±Ø¬ÙØ©','ØªØ¹Ø±Ù‚','Ø¶ÙŠÙ‚ Ù†ÙØ³','Ø§Ø®ØªÙ†Ø§Ù‚','Ø£Ù„Ù… ØµØ¯Ø±','Ø¯ÙˆØ®Ø©','ØºØ«ÙŠØ§Ù†','ØºØ±Ø¨Ø© Ø§Ù„ÙˆØ§Ù‚Ø¹','Ø®ÙˆÙ Ù…Ù† Ø§Ù„Ù…ÙˆØª','Ø®Ø¯Ø±','ØªÙ†Ù…ÙŠÙ„','Ù‚Ø´Ø¹Ø±ÙŠØ±Ø©','Ø³Ø®ÙˆÙ†Ø©'],
    red:['ÙÙ‚Ø¯Ø§Ù† ÙˆØ¹ÙŠ Ù…ØªÙƒØ±Ø±'], tips:['ØªØ¯Ø±ÙŠØ¨ ØªÙ†ÙÙ‘Ø³ ÙˆØ£Ø±Ø¶Ù†Ø©','ØªÙ‚ÙŠÙŠÙ… Ø±Ù‡Ø§Ø¨ Ø§Ù„Ø³Ø§Ø­ Ø¥Ù† ÙˆÙØ¬Ø¯'] },

  { code:'SAD', name:'Ù‚Ù„Ù‚ Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ', group:'Ø§Ù„Ù‚Ù„Ù‚', min:3, core:['Ø®ÙˆÙ Ù…Ù† Ø§Ù„ØªÙ‚ÙŠÙŠÙ…','Ù‚Ù„Ù‚ Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ','Ø®Ø¬Ù„ Ø´Ø¯ÙŠØ¯'], durationMin:180,
    keys:['ØªØ¬Ù†Ù‘Ø¨ Ù…ÙˆØ§Ù‚Ù Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©','Ø§Ø±ØªØ¨Ø§Ùƒ','Ø§Ø­Ù…Ø±Ø§Ø±','Ø§Ø±ØªØ¬Ø§Ù','ØªØ¹Ø±Ù‘Ù‚','ØªØ¹Ø·Ù‘Ù„ ÙˆØ¸ÙŠÙÙŠ'], red:[], tips:['ØªØ¹Ø±Ø¶ ØªØ¯Ø±ÙŠØ¬ÙŠ ÙˆÙ…Ù‡Ø§Ø±Ø§Øª Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©'] },

  { code:'PHOBIA', name:'Ø±ÙÙ‡Ø§Ø¨ Ù…Ø­Ø¯Ø¯', group:'Ø§Ù„Ù‚Ù„Ù‚', min:2, core:['Ø®ÙˆÙ Ø´Ø¯ÙŠØ¯ Ù…Ù† Ø´ÙŠØ¡ Ù…Ø­Ø¯Ø¯','ÙÙˆØ¨ÙŠØ§'], durationMin:180,
    keys:['ØªØ¬Ù†Ù‘Ø¨ Ø§Ù„Ø´ÙŠØ¡','ØªØ­Ù…Ù‘Ù„ Ù…Ø¹ Ù‚Ù„Ù‚ Ø´Ø¯ÙŠØ¯','ØªØ¹Ø·Ù‘Ù„ ÙˆØ¸ÙŠÙÙŠ'], red:[], tips:['Ø§Ù„ØªØ¹Ø±Ù‘Ø¶ Ø§Ù„ØªØ¯Ø±ÙŠØ¬ÙŠ ÙØ¹Ù‘Ø§Ù„ Ø¬Ø¯Ù‹Ø§'] },

  // ÙˆØ³ÙˆØ§Ø³ ÙˆØµØ¯Ù…Ø©
  { code:'OCD', name:'ÙˆØ³ÙˆØ§Ø³ Ù‚Ù‡Ø±ÙŠ', group:'ÙˆØ³ÙˆØ§Ø³/Ù‚Ù‡Ø±', min:2, core:['ÙˆØ³Ø§ÙˆØ³','Ø£ÙÙƒØ§Ø± Ù…ØªØ³Ù„Ø·Ø©'], durationMin:30,
    keys:['Ø³Ù„ÙˆÙƒ Ù‚Ù‡Ø±ÙŠ','ØºØ³Ù„ Ù…ØªÙƒØ±Ø±','ØªÙÙ‚Ø¯ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨','ØªØ±ØªÙŠØ¨','Ø¹Ø¯Ù‘ Ù…ØªÙƒØ±Ø±','Ø¶ÙŠÙ‚ Ø¥Ù† ØªÙˆÙ‚ÙØª Ø§Ù„Ø·Ù‚ÙˆØ³'],
    red:[], tips:['ERP (Ø§Ù„ØªØ¹Ø±Ù‘Ø¶ ÙˆÙ…Ù†Ø¹ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©) Ù‡Ùˆ Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø£Ø¨Ø±Ø²'] },

  { code:'PTSD', name:'Ù…Ø§ Ø¨Ø¹Ø¯ Ø§Ù„ØµØ¯Ù…Ø©', group:'Ø§Ù„ØµØ¯Ù…Ø©', min:4, core:['Ø­Ø§Ø¯Ø«Ø© ØµØ§Ø¯Ù…Ø©','ØªØ¹Ø±Ø¶Øª Ù„Ø§Ø¹ØªØ¯Ø§Ø¡','Ø­Ø±Ø¨','Ø­Ø§Ø¯Ø« Ø´Ø¯ÙŠØ¯'], durationMin:30,
    keys:['Ø°ÙƒØ±ÙŠØ§Øª Ø§Ù‚ØªØ­Ø§Ù…ÙŠØ©','ÙƒÙˆØ§Ø¨ÙŠØ³','ØªØ¬Ù†Ù‘Ø¨ Ù…Ø°ÙƒÙ‘Ø±Ø§Øª','ØªÙŠÙ‚Ø¸ Ù…ÙØ±Ø·','Ø§Ø³ØªØ«Ø§Ø±Ø©','Ù†ÙˆØ¨Ø§Øª ØºØ¶Ø¨','Ø®Ø¯Ø± Ø¹Ø§Ø·ÙÙŠ','Ø§Ù†ÙØµØ§Ù„'],
    red:['Ø®Ø·Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙØ³ Ø£Ùˆ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†'], tips:['Ø¹Ù„Ø§Ø¬ Ù…Ø¹Ø±ÙÙŠ Ù…ØªÙ…Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„ØµØ¯Ù…Ø© / EMDR'] },

  // Ø°Ù‡Ø§Ù†ÙŠ
  { code:'PSY', name:'Ø°Ù‡Ø§Ù†/Ø·ÙŠÙ ÙØµØ§Ù…ÙŠ', group:'Ø°Ù‡Ø§Ù†ÙŠ', min:2, core:['Ù‡Ù„Ø§ÙˆØ³','Ø¶Ù„Ø§Ù„Ø§Øª','ØªÙÙƒÙƒ ÙƒÙ„Ø§Ù…'], durationMin:30,
    keys:['Ù‡Ù„Ø§ÙˆØ³ Ø³Ù…Ø¹ÙŠØ©','Ø£ÙÙƒØ§Ø± Ø§Ø¶Ø·Ù‡Ø§Ø¯','ØªÙÙƒÙƒ Ø§Ù„ØªÙÙƒÙŠØ±','Ø§Ù†Ø³Ø­Ø§Ø¨ Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ','Ø¥Ù‡Ù…Ø§Ù„ Ø°Ø§Øª'],
    red:['Ø£ØµÙˆØ§Øª ØªØ£Ù…Ø±','Ø®Ø·ÙˆØ±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†'], tips:['ØªÙ‚ÙŠÙŠÙ… Ø·Ø¨ÙŠ Ù…Ø¨ÙƒÙ‘Ø± Ù…Ù‡Ù…'] },

  // Ù†Ù…Ø§Ø¦ÙŠ/Ø§Ù†ØªØ¨Ø§Ù‡ ÙˆØªÙˆØ­Ø¯
  { code:'ADHD_A', name:'ÙØ±Ø· Ø­Ø±ÙƒØ© ÙˆØªØ´ØªØª (Ø¨Ø§Ù„Øº)', group:'Ù†Ù…Ø§Ø¦ÙŠ', min:5, core:['ØªØ´ØªØª','Ù†Ù‚Øµ Ø§Ù†ØªØ¨Ø§Ù‡','Ø§Ù†Ø¯ÙØ§Ø¹'], durationMin:180,
    keys:['Ù†Ø³ÙŠØ§Ù†','ÙÙ‚Ø¯ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡','ØªØ£Ø¬ÙŠÙ„','Ø¹Ø¯Ù… Ø¥Ù†Ø¬Ø§Ø²','Ø¨Ø¯Ø¡ Ù…Ù‡Ø§Ù… ÙƒØ«ÙŠØ±Ø©','Ø­Ø±ÙƒØ© Ø²Ø§Ø¦Ø¯Ø©','ØªÙˆØªØ± Ø¬Ø³Ø¯ÙŠ','Ù…Ù‚Ø§Ø·Ø¹Ø© Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†','Ø§Ù†Ø¯ÙØ§Ø¹ÙŠØ©'],
    red:[], tips:['ØªÙ†Ø¸ÙŠÙ… Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø³Ù„ÙˆÙƒÙŠØ©'] },

  { code:'ASD', name:'Ø·ÙŠÙ ØªÙˆØ­Ø¯ (ÙØ­Øµ Ø¨Ø§Ù„ØºÙŠÙ†)', group:'Ù†Ù…Ø§Ø¦ÙŠ', min:4, core:['ØµØ¹ÙˆØ¨Ø§Øª ØªÙˆØ§ØµÙ„ Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ Ù…Ù†Ø° Ø§Ù„Ø·ÙÙˆÙ„Ø©'], durationMin:365,
    keys:['Ø­Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø£ØµÙˆØ§Øª','Ø­Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ù…Ø³','Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª Ø¶ÙŠÙ‚Ø©','Ø±ÙˆØªÙŠÙ† ØµØ§Ø±Ù…','ØµØ¹ÙˆØ¨Ø© Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©','ØªØ§Ø±ÙŠØ® Ù…Ù†Ø° Ø§Ù„Ø·ÙÙˆÙ„Ø©'],
    red:[], tips:['ØªÙ‚ÙŠÙŠÙ… Ù…ØªØ®ØµØµ Ù„Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„Ù…Ø¤ÙƒØ¯'] },

  // Ø¬Ø³Ø¯ÙŠØ©/Ù‚Ù„Ù‚ ØµØ­ÙŠ
  { code:'SSD', name:'Ø£Ø¹Ø±Ø§Ø¶ Ø¬Ø³Ø¯ÙŠØ© Ù…Ø¹ Ù‚Ù„Ù‚ ØµØ­ÙŠ', group:'Ø¬Ø³Ø¯ÙŠ Ø§Ù„Ø´ÙƒÙ„', min:2, core:['Ø£Ø¹Ø±Ø§Ø¶ Ø¬Ø³Ø¯ÙŠØ© Ù…Ø²Ù…Ù†Ø©','Ù‚Ù„Ù‚ Ø¹Ù„Ù‰ Ø§Ù„ØµØ­Ø©'], durationMin:180,
    keys:['ØªÙÙƒÙŠØ± Ù…ÙØ±Ø· Ø¨Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶','ÙØ­ÙˆØµØ§Øª Ù…ØªÙƒØ±Ø±Ø©','Ù‚Ù„Ù‚ ØµØ­ÙŠ Ù…Ø³ØªÙ…Ø±'],
    red:[], tips:['Ø§Ù„ØªØ«Ù‚ÙŠÙ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ù„Ù‚ Ù…Ù‡Ù…Ù‘Ø§Ù†'] },

  { code:'IAD', name:'Ù‚Ù„Ù‚ Ù…Ø±Ø¶ÙŠ (Ù‚Ù„Ù‚ Ø¹Ù„Ù‰ Ø§Ù„ØµØ­Ø©)', group:'Ø¬Ø³Ø¯ÙŠ Ø§Ù„Ø´ÙƒÙ„', min:1, core:['Ù‚Ù„Ù‚ ØµØ­ÙŠ'], durationMin:180,
    keys:['Ø®ÙˆÙ Ù…Ù† Ù…Ø±Ø¶ Ø®Ø·ÙŠØ±','Ø§Ø·Ù…Ø¦Ù†Ø§Ù† Ø·Ø¨ÙŠ Ù…ØªÙƒØ±Ø±','ØªÙÙ‚Ø¯ Ù…Ø³ØªÙ…Ø± Ù„Ø£Ø¹Ø±Ø§Ø¶ Ø¬Ø³Ø¯ÙŠØ©'],
    red:[], tips:['CBT ÙŠØ³ØªÙ‡Ø¯Ù Ø§Ù„Ù…Ø¨Ø§Ù„ØºØ© Ø§Ù„Ø¥Ø¯Ø±Ø§ÙƒÙŠØ©'] },

  // Ø£ÙƒÙ„
  { code:'AN', name:'ÙÙ‚Ø¯Ø§Ù† Ø´Ù‡ÙŠØ© Ø¹ØµØ¨ÙŠ', group:'Ø£ÙƒÙ„', min:3, core:['Ù†Ø­Ø§ÙØ© Ø´Ø¯ÙŠØ¯Ø©','Ø®ÙˆÙ Ù…Ù† Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙˆØ²Ù†'], durationMin:90,
    keys:['ØªÙ‚ÙŠÙŠØ¯ Ø§Ù„Ø£ÙƒÙ„','Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø±Ø§Øª','ØµÙˆØ±Ø© Ø¬Ø³Ù… Ù…Ø´ÙˆÙ‘Ù‡Ø©','Ø¯ÙˆØ®Ø©','Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø­ÙŠØ¶'],
    red:['Ø¯ÙˆØ§Ø± Ø´Ø¯ÙŠØ¯','Ø¥ØºÙ…Ø§Ø¡','Ø¨Ø·Ø¡ Ù‚Ù„Ø¨'], tips:['ÙØ±ÙŠÙ‚ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„ØªØ®ØµØµØ§Øª Ù…Ø·Ù„ÙˆØ¨'] },

  { code:'BN', name:'Ù†Ù‡Ø§Ù… Ø¹ØµØ¨ÙŠ (Ø¨ÙˆÙ„ÙŠÙ…ÙŠØ§)', group:'Ø£ÙƒÙ„', min:3, core:['Ù†Ù‡Ù…','Ø¥ÙØ±Ø§Ø· ÙÙŠ Ø§Ù„Ø£ÙƒÙ„'], durationMin:90,
    keys:['Ø³Ù„ÙˆÙƒ ØªØ¹ÙˆÙŠØ¶ÙŠ (Ù‚ÙŠØ¡/Ù…Ø³Ù‡Ù„/ØµÙˆÙ…)','ØªØ£Ø«Ø± ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø°Ø§Øª Ø¨Ø§Ù„ÙˆØ²Ù†','Ù†ÙˆØ¨Ø§Øª Ù…ØªÙƒØ±Ø±Ø©'],
    red:[], tips:['CBT-E Ø®ÙŠØ§Ø± ÙØ¹Ù‘Ø§Ù„'] },

  { code:'BED', name:'Ù†Ù‡Ù… Ø§Ù„Ø·Ø¹Ø§Ù… (Ø¨Ø¯ÙˆÙ† ØªØ¹ÙˆÙŠØ¶)', group:'Ø£ÙƒÙ„', min:3, core:['Ù†Ù‡Ù…'], durationMin:90,
    keys:['Ø£ÙƒÙ„ Ø³Ø±ÙŠØ¹ Ø¬Ø¯Ù‹Ø§','Ø£ÙƒÙ„ Ø­ØªÙ‰ Ø§Ù„Ø§Ù†Ø²Ø¹Ø§Ø¬','Ø£ÙƒÙ„ Ø¯ÙˆÙ† Ø¬ÙˆØ¹','Ø´Ø¹ÙˆØ± Ø¨Ø§Ù„Ø°Ù†Ø¨ Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ù‡Ù…'],
    red:[], tips:['ØªÙ†Ø¸ÙŠÙ… Ø§Ù„ÙˆØ¬Ø¨Ø§Øª ÙˆØ¯Ø¹Ù… Ø³Ù„ÙˆÙƒÙŠ'] },

  // Ù†ÙˆÙ…
  { code:'INS', name:'Ø£Ø±Ù‚ Ù…Ø²Ù…Ù†', group:'Ù†ÙˆÙ…', min:1, core:['Ø£Ø±Ù‚','ØµØ¹ÙˆØ¨Ø© Ù†ÙˆÙ…','Ø§Ø³ØªÙŠÙ‚Ø§Ø¸ Ù…Ø¨ÙƒØ±'], durationMin:90,
    keys:['ØµØ¹ÙˆØ¨Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ù†ÙˆÙ…','ØµØ­Ùˆ Ù…ØªÙƒØ±Ø±','Ù†Ø¹Ø§Ø³ Ù†Ù‡Ø§Ø±ÙŠ','ØªØ¹Ø¨'],
    red:[], tips:['CBT-I ÙˆÙ†Ø¸Ø§ÙØ© Ø§Ù„Ù†ÙˆÙ…'] },

  // Ù…ÙˆØ§Ø¯/Ø¥Ø¯Ù…Ø§Ù†
  { code:'SUD', name:'Ø§Ø¶Ø·Ø±Ø§Ø¨ ØªØ¹Ø§Ø·ÙŠ Ù…ÙˆØ§Ø¯', group:'Ø¥Ø¯Ù…Ø§Ù†', min:3, core:['ØªØ¹Ø§Ø·ÙŠ','Ù…Ø®Ø¯Ø±Ø§Øª','ÙƒØ­ÙˆÙ„','Ù…Ù†Ø¨Ù‘Ù‡Ø§Øª'], durationMin:90,
    keys:['Ø±ØºØ¨Ø© Ù‚ÙˆÙŠØ©','ÙÙ‚Ø¯ Ø§Ù„Ø³ÙŠØ·Ø±Ø©','Ø£ÙƒØ«Ø± Ù…Ù…Ø§ Ø£Ù†ÙˆÙŠ','Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙØ§Ø´Ù„Ø©','ÙˆÙ‚Øª Ø·ÙˆÙŠÙ„ Ù„Ù„ØªØ¹Ø§Ø·ÙŠ/Ø§Ù„ØªØ¹Ø§ÙÙŠ','Ù…Ø´Ø§ÙƒÙ„ Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©/Ù…Ù‡Ù†ÙŠØ©','ØªØ­Ù…Ù‘Ù„','Ø§Ù†Ø³Ø­Ø§Ø¨'],
    red:['ØªØ¹Ø§Ø·ÙŠ Ø­Ù‚Ù†','Ø¥ØºÙ…Ø§Ø¡','Ø¬Ø±Ø¹Ø© Ø²Ø§Ø¦Ø¯Ø©'], tips:['Ø®Ø·Ø© Ø§Ù…ØªÙ†Ø§Ø¹ + Ø¯Ø¹Ù… + Ø£Ø­ÙŠØ§Ù†Ù‹Ø§ Ø¯ÙˆØ§Ø¡'] },

  // Ø´Ø®ØµÙŠØ© (ÙØ­ÙˆØµ)
  { code:'BPD_S', name:'Ù†Ù…Ø· Ø¹Ø§Ø·ÙÙŠ ØºÙŠØ± Ù…Ø³ØªÙ‚Ø± (ÙØ­Øµ)', group:'Ø´Ø®ØµÙŠØ©', min:5, core:['Ø§Ù†Ø¯ÙØ§Ø¹','Ø¹Ù„Ø§Ù‚Ø§Øª Ù…Ø¶Ø·Ø±Ø¨Ø©','ØªÙ‚Ù„Ù‘Ø¨ Ù…Ø²Ø§Ø¬'], durationMin:180,
    keys:['Ø®ÙˆÙ Ù‡Ø¬Ø±','Ø§Ù†Ø¯ÙØ§Ø¹ Ù…Ø¤Ø°Ù Ù„Ù„Ø°Ø§Øª','ÙØ±Ø§Øº Ù…Ø²Ù…Ù†','ØºØ¶Ø¨ Ø´Ø¯ÙŠØ¯','Ø¥ÙŠØ°Ø§Ø¡ Ø§Ù„Ø°Ø§Øª','Ù†Ø¯ÙˆØ¨'],
    red:['Ø§Ù†ØªØ­Ø§Ø±','Ø¥ÙŠØ°Ø§Ø¡ Ø§Ù„Ø°Ø§Øª'], tips:['Ù…Ù‡Ø§Ø±Ø§Øª DBT ÙˆØªÙ†Ø¸ÙŠÙ… Ø§Ù†ÙØ¹Ø§Ù„ÙŠ'] },

  // ØªÙØ§Ø±Ù‚ÙŠ
  { code:'DISS', name:'ØªÙØ§Ø±Ù‚ÙŠ (ÙØ¬ÙˆØ§Øª/ØªØ¨Ø¯Ø¯/ØªØºØ±Ù‘Ø¨)', group:'ØªÙØ§Ø±Ù‚ÙŠ', min:2, core:['ÙØ¬ÙˆØ§Øª Ø°Ø§ÙƒØ±Ø©','ØªØ¨Ø¯Ø¯','ØªØºØ±Ù‘Ø¨'], durationMin:0,
    keys:['Ø§Ù†ÙØµØ§Ù„','Ø¥Ø­Ø³Ø§Ø³ Ø¨Ø¹Ø¯Ù… Ø§Ù„ÙˆØ§Ù‚Ø¹ÙŠØ©','Ù†Ø³ÙŠØ§Ù† Ø£Ø­Ø¯Ø§Ø« Ù…Ù‡Ù…Ø©'],
    red:[], tips:['ØªÙ‚ÙŠÙŠÙ… Ù…ØªØ®ØµØµ Ø¹Ù†Ø¯ Ø§Ù„Ø´Ùƒ'] },
];

/* ============ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ ============ */
function normalize(t){ return (t||'').toString().trim().toLowerCase(); }

function analyze(){
  const name = document.getElementById('name').value.trim();
  const age  = document.getElementById('age').value.trim();
  const gender = document.getElementById('gender').value.trim();
  const dur = parseInt(document.getElementById('duration').value||'0',10) || 0;
  const txt = normalize(document.getElementById('symptoms').value);

  const flags = [];
  if (txt.includes('Ø§Ù†ØªØ­Ø§Ø±') || txt.includes('Ø£Ø¤Ø°ÙŠ Ù†ÙØ³ÙŠ') || txt.includes('Ù‚ØªÙ„ Ù†ÙØ³ÙŠ')) flags.push('âš ï¸ Ù…Ø¤Ø´Ø±Ø§Øª Ø®Ø·Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙØ³ (ÙŠØ±Ø¬Ù‰ Ø·Ù„Ø¨ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¹Ø§Ø¬Ù„Ø©)');
  if (txt.includes('Ø£ØµÙˆØ§Øª') || txt.includes('Ù‡Ù„Ø§ÙˆØ³') || txt.includes('Ø¶Ù„Ø§Ù„Ø§Øª')) flags.push('âš ï¸ Ù…Ø¤Ø´Ø±Ø§Øª Ø°Ù‡Ø§Ù†ÙŠØ© ØªØªØ·Ù„Ø¨ ØªÙ‚ÙŠÙŠÙ…Ù‹Ø§ Ø³Ø±ÙŠØ¹Ù‹Ø§');

  const scored = RULES.map(r=>{
    // ØªØ­Ù‚Ù‚ Ø§Ù„Ø£Ø³Ø§Ø³
    const coreHit = r.core.length===0 ? true : r.core.some(k=>txt.includes(k));
    if(!coreHit) return null;

    // Ø¹Ø¯Ù‘ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø§Øª Ù…Ù† Ø§Ù„Ù…ÙØ§ØªÙŠØ­
    let met = 0, matched=[];
    r.keys.forEach(k=>{
      // Ø¯Ø¹Ù… "or" Ø§Ù„Ø¨Ø³ÙŠØ· Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙØªØ§Ø­: "Ø³Ù„ÙˆÙƒ ØªØ¹ÙˆÙŠØ¶ÙŠ (Ù‚ÙŠØ¡/Ù…Ø³Ù‡Ù„/ØµÙˆÙ…)" â†’ Ù†Ù‚Ø³Ù… Ø¹Ù„Ù‰ / ÙˆØ§Ù„Ù€ or
      const variants = k.split('/').join('|').split('|').map(x=>x.trim()).filter(Boolean);
      if (variants.some(v=>txt.includes(v))){
        met++; matched.push(k);
      }
    });

    // Ø´Ø±Ø· Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰
    if (met < r.min) return {r,score:0,met,matched};

    // Ø¯Ø±Ø¬Ø© Ø£ÙˆÙ„ÙŠØ©: ØªØºØ·ÙŠØ© Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶
    const coverage = met / Math.max(r.keys.length, r.min);
    let score = 1 / (1 + Math.exp(-8*(coverage - 0.5))); // Ø¯Ø§Ù„Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ©

    // Ù…ÙƒØ§ÙØ£Ø© Ù„Ù„Ù…Ø¯Ø© Ø¹Ù†Ø¯ Ø§Ø³ØªÙŠÙØ§Ø¡ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰
    if (r.durationMin && dur >= r.durationMin) score = Math.min(1, score + 0.1);

    // Ø¹Ù‚ÙˆØ¨Ø© Ø¥Ù† ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø¯Ø© Ø£Ù‚ØµØ± Ø¨ÙƒØ«ÙŠØ±
    if (r.durationMin && dur>0 && dur < r.durationMin/2) score = Math.max(0, score - 0.1);

    // Ø£Ø¹Ù„Ø§Ù… Ø­Ù…Ø±Ø§Ø¡ Ø®Ø§ØµØ©
    const reds = (r.red||[]).filter(x=>txt.includes(x));

    return { r, score, met, matched, reds };
  }).filter(Boolean);

  scored.sort((a,b)=>b.score - a.score);

  // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
  const results = document.getElementById('results');
  const list = document.getElementById('list');
  const flagsBox = document.getElementById('flags');
  list.innerHTML = ''; flagsBox.innerHTML = '';
  if(flags.length) flagsBox.innerHTML = flags.map(f=>`<div class="bad">${f}</div>`).join('');

  if (scored.length===0){
    results.style.display='block';
    list.innerHTML = `<div class="item"><b>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø·Ø§Ø¨Ù‚Ø© ÙƒØ§ÙÙŠØ©</b><div class="muted">Ø¬Ø±Ù‘Ø¨ ÙˆØµÙÙ‹Ø§ Ø£Ø¯Ù‚ Ù„Ù„Ø£Ø¹Ø±Ø§Ø¶ ÙˆØ§Ù„Ù…Ø¯Ø©.</div></div>`;
    return;
  }

  scored.slice(0,8).forEach(({r,score,met,matched,reds})=>{
    const pct = Math.round(score*100);
    const redsHtml = (reds&&reds.length)? `<div class="bad" style="margin-top:6px">âš ï¸ Ø£Ø¹Ù„Ø§Ù… Ø­Ù…Ø±Ø§Ø¡: ${reds.join('ØŒ ')}</div>` : '';
    const tipsHtml = (r.tips&&r.tips.length)? `<div class="muted" style="margin-top:6px">Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª: ${r.tips.join(' â€” ')}</div>` : '';
    const el = document.createElement('div');
    el.className='item';
    el.innerHTML = `
      <div style="display:flex;justify-content:space-between;gap:10px;align-items:center;margin-bottom:6px">
        <div><b>${r.name}</b> <span class="muted">(${r.group})</span></div>
        <div style="min-width:120px;text-align:left"><small>Ø§Ù„Ø«Ù‚Ø©</small></div>
      </div>
      <div class="bar"><i style="width:${pct}%"></i></div>
      <div class="muted" style="margin-top:6px">Ø£Ø¹Ø±Ø§Ø¶ Ù…Ø·Ø§Ø¨Ù‚Ø©: ${met} â€¢ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰: ${r.min}${r.durationMin?` â€¢ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§ â‰¥ ${r.durationMin} ÙŠÙˆÙ…`:''}</div>
      ${matched.length?`<div style="margin-top:6px">${matched.slice(0,6).map(k=>`<span class="pill">${k}</span>`).join(' ')}</div>`:''}
      ${redsHtml}
      ${tipsHtml}
    `;
    list.appendChild(el);
  });

  results.style.display='block';
}

/* ============ Ù…Ø±Ø¬Ø¹ Ø§Ù„Ø§Ø¶Ø·Ø±Ø§Ø¨Ø§Øª (ÙƒØªØ§Ù„ÙˆØ¬) ============ */
function renderCatalog(){
  const byGroup = {};
  RULES.forEach(r => {
    (byGroup[r.group] = byGroup[r.group] || []).push(r);
  });
  const root = document.getElementById('catalog');
  root.innerHTML = '';
  Object.keys(byGroup).forEach(group=>{
    const box = document.createElement('details');
    box.open = false;
    const items = byGroup[group].map(r=>{
      const keys = r.keys.slice(0,8).map(k=>`<span class="pill">${k}</span>`).join(' ');
      return `<div class="item">
        <div><b>${r.name}</b> <span class="muted">â€” Ø­Ø¯ Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø£Ø¹Ø±Ø§Ø¶: ${r.min}${r.durationMin?`, ÙˆØ§Ù„Ù…Ø¯Ù‘Ø© â‰¥ ${r.durationMin} ÙŠÙˆÙ…`:''}</span></div>
        <div style="margin-top:6px">${keys}</div>
      </div>`;
    }).join('');
    box.innerHTML = `<summary>${group}</summary>${items}`;
    root.appendChild(box);
  });
}
renderCatalog();

/* ============ Ø£Ø¯ÙˆØ§Øª ============ */
function resetForm(){
  ['name','age','gender','duration','symptoms'].forEach(id=>{
    const el = document.getElementById(id); if(el) el.value='';
  });
  const results = document.getElementById('results');
  results.style.display='none';
}

/* ============ ØªÙ‡ÙŠØ¦Ø© Ù…Ù† Ø¨Ø§Ø±Ø§Ù…ØªØ±Ø§Øª Ø§Ù„Ø±Ø§Ø¨Ø· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) ============ */
(function prefillFromURL(){
  const p = new URLSearchParams(location.search);
  if(p.get('symptoms')) document.getElementById('symptoms').value = p.get('symptoms');
  if(p.get('duration')) document.getElementById('duration').value = p.get('duration');
})();
</script>
</body>
</html>
